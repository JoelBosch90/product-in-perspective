!function(){"use strict";class t{_triggers={};_bubbleTo=[];constructor(){}trigger=(e,t)=>{if(this._triggers[e]&&this._triggers[e].forEach((e=>{e(t)})),this._bubbleTo)for(const s of this._bubbleTo)s.trigger(e,t);return this};bubbleTo=e=>(!e instanceof t||this._bubbleTo.push(e),this);bubbleOff=e=>(!e instanceof t||(this._bubbleTo=this._bubbleTo.filter((t=>t!=e))),this);on=(e,t)=>(null==this._triggers[e]&&(this._triggers[e]=[]),this._triggers[e].push(t),this);off=(e,t)=>(null==this._triggers[e]||(this._triggers[e]=this._triggers[e].filter((e=>e!==t))),this);remove(){this._triggers={},this._bubbled=[]}}class s extends t{_container=null;_pageTitle=null;pageTitle(e){return this._pageTitle=e,document.getElementsByTagName("title")[0].textContent=e,this}show(){return this._container&&this._container.removeAttribute("hidden"),this._pageTitle&&this.pageTitle(this._pageTitle),this}hide(){return this._container&&this._container.setAttribute("hidden",""),this}remove(){this._container&&this._container.remove(),super.remove()}}const i=e=>{history.pushState({},"",e),dispatchEvent(new PopStateEvent("popstate",{state:{}}))};const n=(e,t)=>e==t||(e instanceof Map?a(e,t):e instanceof Array?r(e,t):e instanceof Object&&o(e,t)),o=(e,t)=>{if(!e instanceof Object||!t instanceof Object)return!1;const s=Object.entries(e);if(s.length!=Object.keys(t).length)return!1;if(0==s.length)return!0;for(const[e,i]of s){if(!t.hasOwnProperty(e))return!1;if(!n(i,t[e]))return!1}return!0},r=(e,t)=>{if(!e instanceof Array||!t instanceof Array)return!1;if(e.length!=t.length)return!1;if(0==e.length)return!0;for(let s=0;s<e.length;s++)if(!n(e[s],t[s]))return!1;return!0},a=(e,t)=>{if(!e instanceof Map||!t instanceof Map)return!1;if(e.size!=t.size)return!1;if(0==e.size)return!0;const s=e.keys(),i=e.values(),o=t.keys(),r=t.values();for(let t=0;t<e.size;t++){if(!n(s.next().value,o.next().value))return!1;if(!n(i.next().value,r.next.value))return!1}return!0};const l=()=>document.cookie.split("; ").reduce(((e,t)=>{const[s,i]=t.split("=");return e[s]=i,e}),{});class h extends s{_title=null;constructor(e,t,s){super(),this._container=document.createElement("div"),this._container.classList.add("apology"),this._title=document.createElement("h1"),this._title.textContent=t,this._container.appendChild(this._title),s&&this.addLink(s.text,s.location),e.appendChild(this._container)}update=e=>(this._title.textContent=e,this);addLink=(e,t)=>{const s=document.createElement("a");s.classList.add("button"),s.setAttribute("href",t),s.textContent=e,s.addEventListener("click",(e=>{e.preventDefault(),i(t)})),this._container.appendChild(s)};remove(){this._title&&this._title.remove(),super.remove()}}class c{_apiUrl="";_storageUrl="";constructor(){const e=window.location.protocol+"//"+window.location.host;this._apiUrl=e+"/api",this._storageUrl=e+"/models"}model=e=>this._storageUrl+"/"+e+".glb";_errorCheck=async e=>{const t=await e;if(429==t.status)throw new Error("Received too many requests. Try again later.");if(401==t.status)throw new Error("Request not allowed. You need to be logged in.");return t};_xsrfToken=()=>l().xsrfToken;get=async(e="")=>this._errorCheck(fetch(this._apiUrl+e,{method:"GET",mode:"cors",cache:"no-cache",credentials:"include",headers:{"Content-Type":"application/json","X-XSRF-TOKEN":this._xsrfToken()},redirect:"follow",referrerPolicy:"no-referrer"}));put=async(e="",t={})=>this._encodeFiles(t).then((t=>this._errorCheck(fetch(this._apiUrl+e,{method:"PUT",mode:"cors",cache:"no-cache",credentials:"include",headers:{"Content-Type":"application/json","X-XSRF-TOKEN":this._xsrfToken()},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(t)}))));post=async(e="",t={})=>this._encodeFiles(t).then((t=>this._errorCheck(fetch(this._apiUrl+e,{method:"POST",mode:"cors",cache:"no-cache",credentials:"include",headers:{"Content-Type":"application/json","X-XSRF-TOKEN":this._xsrfToken()},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(t)}))));delete=async(e="")=>this._errorCheck(fetch(this._apiUrl+e,{method:"DELETE",mode:"cors",cache:"no-cache",credentials:"include",headers:{"Content-Type":"application/json","X-XSRF-TOKEN":this._xsrfToken()},redirect:"follow",referrerPolicy:"no-referrer"}));_encodeFiles=async e=>new Promise(((t,s)=>{try{const s={},i=[];for(const[t,n]of Object.entries(e))n instanceof File?i.push(this._encodeFile(n).then((e=>{s[t]=e}))):s[t]=n;Promise.all(i).then((()=>{t(s)}))}catch(e){s(e)}}));_encodeFile=async e=>new Promise(((t,s)=>{const i=new FileReader;i.onload=()=>{t({file:i.result,extension:e.name.split(".").pop()})},i.onerror=e=>{s(e)},i.onabort=e=>{s(e)},i.readAsDataURL(e)}));remove(){}}class d extends s{_options=[];constructor(e,t={}){if(super(),this._container=document.createElement("select"),this._container.addEventListener("change",(e=>{this.trigger("change",e)})),t.name&&(this._container.name=t.name),t.required&&this._container.setAttribute("required",!0),t.disabled&&this.disabled(t.disabled),t.multiple&&this._container.setAttribute("multiple",!0),t.tooltip&&this._container.setAttribute("title",t.tooltip),t.placeholder){const e=this.addOption("",t.placeholder);e.selected=!0,e.disabled=!0,e.hidden=!0}if(t.options)for(const e of t.options)this.addOption(e.value,e.label);e.appendChild(this._container)}value=e=>void 0===e?this._container.selectedOptions.length?this._container.selectedOptions[0].disabled?"":this._container.value:"":(this._container.value=e,this);labels=()=>[...this._container.selectedOptions].map((e=>e.textContent));disabled=e=>void 0===e?this._container.disabled:(this._container.disabled=e,this);addOption=(e,t)=>{if(!t)return;const s=document.createElement("option");return e&&(s.value=e),s.textContent=t,this._options.push(s),this._container.appendChild(s),s};clear=()=>{for(const e of this._options)e.remove();return this._options=[],this};remove(){this.clear(),super.remove()}}class u extends s{constructor(e,t={}){super(),this._container=document.createElement("button"),t.type&&this._container.setAttribute("type",t.type),t.label&&(this._container.textContent=t.label),t.disabled&&this.disabled(t.disabled),this._container.addEventListener("click",this._onClick),e.appendChild(this._container)}_onClick=e=>{this.trigger("click",e)};disabled=e=>void 0===e?this._container.disabled:(this._container.disabled=e,this);remove=()=>{this._container.removeEventListener("click",this._onClick),super.remove()}}class _ extends s{_hiddenSelect=[];_options=[];_add=null;_clear=null;constructor(e,t={}){super(),this._container=document.createElement("fieldset"),t.tooltip&&this._container.setAttribute("title",t.tooltip);const s=document.createElement("div");if(s.classList.add("multiselect"),this._container.appendChild(s),t.label&&this.label(t.label),this._select=new d(s,{label:t.label}),this._createHiddenField(t),t.options)for(const e of t.options)this.addOption(e);this._add=new u(s,{label:"Add",disabled:!0}).on("click",this.selectCurrent),this._select.on("change",this._checkAddState),this._selectionDisplay=document.createElement("div"),this._selectionDisplay.classList.add("selections"),s.appendChild(this._selectionDisplay),this._clear=new u(s,{label:"Clear",type:"reset",disabled:!0}).on("click",this.reset),e.appendChild(this._container)}label=e=>(this._legend?e?this._legend.textContent=e:this._legend.remove():e&&(this._legend=document.createElement("legend"),this._legend.textContent=e,this._container.prepend(this._legend)),this);_createHiddenField=e=>{if(this._hiddenSelect=document.createElement("select"),this._hiddenSelect.setAttribute("hidden",""),this._hiddenSelect.setAttribute("multiple",!0),this._hiddenSelect.name=e.name,e.options)for(const t of e.options)this._addHiddenOption(t.value,t.label);this._container.appendChild(this._hiddenSelect)};_addHiddenOption=(e,t)=>{const s=document.createElement("option");s.value=e,s.textContent=t,this._hiddenSelect.appendChild(s)};_checkAddState=()=>{const e=this._select.value();if(!e)return this._add.disabled(!0);const t=this.value().includes(e);return this._add.disabled(t)};selectCurrent=e=>{e.preventDefault();const t=this._select.value(),s=this._select.labels()[0];return this.select(t,s)};reset=e=>(e.preventDefault(),this.clear());select=(e,t)=>{this._selectHidden(e),this._checkAddState(),this._clear.disabled(!1);const s=document.createElement("p");return s.classList.add("selection"),s.textContent=t,this._selectionDisplay.appendChild(s),this};_selectHidden=e=>{for(const t of this._hiddenSelect.options)t.value==e&&t.setAttribute("selected",!0)};value=e=>{if(void 0===e){return[...this._hiddenSelect.selectedOptions].map((e=>e.value))}for(const t of e)this.select(t._id,t.name);return this};disabled=e=>void 0===e?this._container.disabled:(this._container.disabled=e,this._hiddenSelect.disabled=e,this._add.disabled=e,this._clear.disabled=e,this._select.disabled(e),this);addOption=(e,t)=>{this._addHiddenOption(e,t);const s=this._select.addOption(e,t);return this._options.push(s),this._checkAddState(),s};clear=()=>{for(const e of this._hiddenSelect.options)e.removeAttribute("selected");for(this._clear.disabled(!0);this._selectionDisplay.firstChild;)this._selectionDisplay.removeChild(this._selectionDisplay.lastChild);return this._checkAddState(),this};remove(){this.clear(),this._select&&this._select.remove(),this._hiddenSelect&&this._hiddenSelect.remove(),super.remove()}}class p extends s{_select=null;_id=null;constructor(e,t={}){switch(super(),this._id="input-"+this._uuidv4(),t.type){case"textarea":this._createTextarea(e,t);break;case"file":this._createFileButton(e,t);break;case"select":this._createSelect(e,t);break;case"multiselect":this._createMultiSelect(e,t);break;default:this._createInput(e,t)}}_uuidv4=()=>([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)));_createInput=(e,t)=>{this._container=document.createElement("div"),this._container.classList.add("input-field"),t.tooltip&&this._container.setAttribute("title",t.tooltip),this._input=document.createElement("input"),this._input.id=this._id,this._input.name=t.name,this._input.setAttribute("type",t.type||"text"),this._input.setAttribute("placeholder",t.label),t.required&&this._input.setAttribute("required",!0),t.disabled&&this.disabled(t.disabled),t.step&&this._input.setAttribute("step",t.step),this._label=document.createElement("label"),this._label.setAttribute("for",this._id);const s=document.createElement("span");s.textContent=t.label,this._label.appendChild(s),this._container.appendChild(this._input),this._container.appendChild(this._label),e.appendChild(this._container)};_createTextarea=(e,t)=>{this._container=document.createElement("div"),this._container.classList.add("input-field"),t.tooltip&&this._container.setAttribute("title",t.tooltip),this._input=document.createElement("textarea"),this._input.id=this._id,this._input.name=t.name,this._input.setAttribute("type",t.type),this._input.setAttribute("placeholder",t.label),t.required&&this._input.setAttribute("required",!0),t.disabled&&this.disabled(t.disabled),this._label=document.createElement("label"),this._label.setAttribute("for",this._id);const s=document.createElement("span");s.textContent=t.label,this._label.appendChild(s),this._container.appendChild(this._input),this._container.appendChild(this._label),e.appendChild(this._container)};_createFileButton=(e,t)=>{this._container=document.createElement("div"),this._container.classList.add("file-button"),t.tooltip&&this._container.setAttribute("title",t.tooltip),this._input=document.createElement("input"),this._input.id=this._id,this._input.name=t.name,this._input.setAttribute("type",t.type),t.accept&&this._input.setAttribute("accept",t.accept),t.required&&this._container.setAttribute("required",!0),t.disabled&&this.disabled(t.disabled);const s=document.createElement("label");s.setAttribute("for",this._id);const i=document.createElement("span");i.textContent=t.label,s.appendChild(i),this._input.addEventListener("change",(()=>{const e=this._input.files;if(e.length){const t=e[0];s.textContent=`${t.name} (${t.size} bytes)`}else s.textContent=t.label})),this._container.appendChild(this._input),this._container.appendChild(s),e.appendChild(this._container)};_createSelect=(e,t)=>{this._container=new d(e,t)};_createMultiSelect=(e,t)=>{this._container=new _(e,t)};addOption=(...e)=>{if(!(!this._container instanceof d))return this._container.addOption(...e)};value=e=>this._container instanceof d||this._container instanceof _?void 0===e?this._container.value():(this._container.value(e),this):void 0===e?"file"==this._input.type?this._input.files[0]:this._input.value:(this._input.value=e,this);disabled=e=>this._container instanceof d?void 0===e?this._container.disabled():(this._container.disabled(e),this):void 0===e?this._input.disabled:(this._input.disabled=e,this)}class m extends s{_legend=null;_inputContainer=null;_inputs={};_fieldsets={};_buttons={};_prefix=null;constructor(e,t={}){if(super(),this._container=document.createElement("fieldset"),this._inputContainer=document.createElement("div"),this._inputContainer.classList.add("fieldset-inputs"),this._container.appendChild(this._inputContainer),t.legend&&this.legend(t.legend),t.tooltip&&this._container.setAttribute("title",t.tooltip),this._prefix=t.name+"-",t.inputs)for(const e of t.inputs)this.addInput(e.name,e.options);if(t.fieldsets)for(const e of t.fieldsets)this.addFieldset(e.name,e.options);if(t.buttons)for(const e of t.buttons)this.addButton(e.name,e.options);e.appendChild(this._container)}legend=e=>(this._legend?e?this._legend.textContent=e:this._legend.remove():e&&(this._legend=document.createElement("legend"),this._legend.textContent=e,this._container.prepend(this._legend)),this);addInput=(e,t={})=>{const s=this._prefix+e,i=new p(this._inputContainer,Object.assign({},t,{name:s}));return this._inputs[s]&&this._inputs[s].remove(),this._inputs[s]=i,i};addFieldset=(e,t={})=>{const s=this._prefix+e,i=new m(this._inputContainer,Object.assign({},t,{name:s}));return this._fieldsets[s]&&this._fieldsets[s].remove(),this._fieldsets[s]=i,i};addButton=(e,t={})=>{const s=this._prefix+e,i=new u(this._inputContainer,Object.assign({},t,{name:s}));return this._buttons[s]&&this._buttons[s].remove(),this._buttons[s]=i,i};values=e=>{if(void 0===e){const e={};for(const[t,s]of Object.entries(this._inputs))e[t]=s.value();for(const[t,s]of Object.entries(this._fieldsets))Object.assign(e,s.values());return e}for(const[t,s]of Object.entries(e)){const e=this._inputs[t];e&&e.value(s)}for(const t of Object.values(this._fieldsets))t.values(e);return this};disabled=e=>void 0===e?this._container.disabled:(this._container.disabled=e,this);remove(){if(this._legend&&this._legend.remove(),this._inputs)for(const e of Object.values(this._inputs))e.remove();if(this._fieldsets)for(const e of Object.values(this._fieldsets))e.remove();if(this._buttons)for(const e of Object.values(this._buttons))e.remove();super.remove()}}class v extends s{constructor(e,t){super(),this._container=document.createElement(t.type||"h1"),t.title&&(this._container.textContent=t.title),e.appendChild(this._container)}update=e=>(this._container.textContent=e,this)}class f extends s{constructor(e){super(),this._container=document.createElement("div"),this._container.classList.add("error-display"),e.appendChild(this._container)}add=e=>{if("string"!=typeof e)return;const t=document.createElement("p");return t.textContent="Error: "+e,this._container.appendChild(t),this};clear=()=>{for(;this._container.firstChild;)this._container.firstChild.remove();return this};remove=()=>{super.remove()}}class b extends s{_title=null;_errorDisplay=null;_inputs={};_fieldsets={};_buttons={};_params=null;_request=null;constructor(e,t={},s){if(super(),this._container=document.createElement("form"),this._request=new c,t.params&&(this._params=t.params),this._container.addEventListener("submit",this.submit),t.title&&this.title(t.title),this._errorDisplay=new f(this._container),t.center&&this._container.classList.add("center"),t.inputs)for(const e of t.inputs)this.addInput(e.name,e.options);if(t.fieldsets)for(const e of t.fieldsets)this.addFieldset(e.name,e.options);if(t.buttons)for(const e of t.buttons)this.addButton(e.name,e.options);t.params&&t.params.get&&this._request.get(t.params.get).then(this._prefill).catch((e=>this.showError(e))),e.appendChild(this._container)}title=e=>(this._title?e?this._title.update(e):this._title.remove():e&&(this._title=new v(this._container,{title:e})),this);addInput=(e,t={})=>{const s=new p(this._container,Object.assign({},t,{name:e}));return this._inputs[e]&&this._inputs[e].remove(),this._inputs[e]=s,s};addFieldset=(e,t={})=>{const s=new m(this._container,Object.assign({},t,{name:e}));return this._fieldsets[e]&&this._fieldsets[e].remove(),this._fieldsets[e]=s,s};addButton=(e,t={})=>{const s=new u(this._container,Object.assign({},t,{name:e}));return this._buttons[e]&&this._buttons[e].remove(),this._buttons[e]=s,s};submit=e=>{e&&e.preventDefault();const t=this.values();if(this.trigger("submit",t),this._params)return this._params.put?this._request.put(this._params.put,t).then(this._submitResponseHandler).catch((e=>this.showError(e))):this._params.post?this._request.post(this._params.post,t).then(this._submitResponseHandler).catch((e=>this.showError(e))):void 0};_submitResponseHandler=e=>{e.json().then((t=>{if(!e.ok)return this.showError(t.error);this.trigger("stored",t)}))};showError=e=>{const t=e instanceof Error?e.message:e;return this._errorDisplay.clear().add(t),this};_prefill=e=>{e.json().then((t=>{if(!e.ok)return this.showError(t.error);this.values(t)}))};values=e=>{if(void 0===e){const e={};for(const[t,s]of Object.entries(this._inputs))e[t]=s.value();for(const[t,s]of Object.entries(this._fieldsets))Object.assign(e,s.values());return e}for(const[t,s]of Object.entries(e)){const e=this._inputs[t];e&&e.value(s)}for(const t of Object.values(this._fieldsets))t.values(e);return this};remove(){if(this._title&&this._title.remove(),this._inputs)for(const e of Object.values(this._inputs))e.remove();if(this._fieldsets)for(const e of Object.values(this._fieldsets))e.remove();if(this._buttons)for(const e of Object.values(this._buttons))e.remove();this._request&&this._request.remove(),this._title=null,this._inputs={},this._fieldsets={},this._buttons={},super.remove()}}class g extends s{_container=null;_form=null;constructor(e,t={}){super(),this._container=document.createElement("div"),this._container.classList.add("login","component");const s="Login";this.pageTitle(s),this._form=new b(this._container,{title:s,center:!0,params:{post:"/login"},inputs:[{name:"email",options:{label:"Email address",type:"email",required:!0}},{name:"password",options:{label:"Password",type:"password",required:!0}}],buttons:[{name:"submit",options:{label:"Login",type:"submit"}}]}),this._form.on("stored",(e=>{i("/admin/apps")}));const n=document.createElement("a");n.addEventListener("click",(()=>{i("/register")})),n.textContent="No account? Register one here.";const o=document.createElement("p");o.appendChild(n),this._container.appendChild(o),e.appendChild(this._container)}remove(){this._form.remove(),super.remove()}}class w extends s{_top=null;_bottom=null;constructor(e){super(),this._container=document.createElement("div"),this._container.classList.add("overlay"),this._top=document.createElement("section"),this._top.classList.add("overlay-top"),this._container.appendChild(this._top),this._bottom=document.createElement("section"),this._bottom.classList.add("overlay-bottom"),this._container.appendChild(this._bottom),e.appendChild(this._container)}add=(e,t={})=>{const s=document.createElement(e);return t.text&&(s.textContent=t.text),t.animated&&s.classList.add("animated"),"top"==t.location?this._top.appendChild(s):this._bottom.appendChild(s),s};remove(){this._top.remove(),this._bottom.remove(),super.remove()}}class y extends s{_overlay=null;_state=null;constructor(e){super();const t=this._initInterface(e);this._state={inputStream:{type:"LiveStream",constraints:{width:{min:1280},height:{min:720},facingMode:"environment",aspectRatio:{min:1,max:2}},target:t},numOfWorkers:0,frequency:10,decoder:{readers:[{format:"ean_reader",config:{}},{format:"ean_8_reader",config:{}},{format:"upc_reader",config:{}},{format:"upc_e_reader",config:{}},{format:"code_93_reader",config:{}}],multiple:!1},locate:!0,locator:{patchSize:"medium",halfSample:!0}},this._initQuagga()}_initQuagga=()=>{this.start(),Quagga.onDetected((e=>{const t=e.codeResult.code;this.trigger("scanned",{code:t})}))};_initInterface=e=>{this._container=document.createElement("div"),this._container.classList.add("barcodescanner");const t=document.createElement("div");return t.classList.add("barcodescanner-video"),this._container.appendChild(t),this._initOverlay(this._container),e.appendChild(this._container),t};_initOverlay=e=>{const t=document.createElement("div");t.classList.add("barcodescanner-overlay"),this._overlay=new w(t),e.appendChild(t)};_handleError=e=>{this.trigger("error",e)};overlay=()=>this._overlay;start=(e=this._state)=>(Quagga.init(e,(e=>{if(e)return this._handleError(e);Quagga.start()})),this);stop=()=>(Quagga.stop(),this);remove(){this.stop(),delete this._state,this._overlay.remove(),super.remove()}}class C{_renderer=null;_hitTestSource=null;_session=null;_options=null;constructor(e,t){this._renderer=e,this._options=t,this._renderer.xr.addEventListener("sessionend",(()=>this._resetHitTestSource())),this._renderer.xr.addEventListener("sessionstart",(()=>this._onSessionStart())),this._renderer.xr.isPresenting&&this._onSessionStart()}_resetHitTestSource=()=>{this._hitTestSource=null};_onSessionStart=async()=>(this._session=this._renderer.xr.getSession(),this._options.space?this._hitTestSource=await this._session.requestHitTestSource(this._options):this._options.profile?this._hitTestSource=await this._session.requestHitTestSourceForTransientInput(this._options):void 0);doHit=e=>{if(!this._renderer.xr.isPresenting)return;const t=this._renderer.xr.getReferenceSpace();return this._hitTestSource&&e.getViewerPose(t)?this._options.profile?this._transientHitTest(e,t):this._hitTest(e,t):void 0};_hitTest=(e,t)=>{const s=e.getHitTestResults(this._hitTestSource);if(!s.length)return!1;return{pose:s[0].getPose(t),inputSpace:this._options.space}};_transientHitTest=(e,t)=>{const s=e.getHitTestResultsForTransientInput(this._hitTestSource);if(!s.length)return!1;const i=s[0];if(!i.length)return!1;return{pose:i[0].getPose(t),inputSpace:s[0].inputSource.targetRaySpace}};remove=()=>{}}class x extends s{_container=null;_cache=new Map;_latestSuccess=!1;constructor(e){super(),this._registerPrimitive("ar-hit-test"),this._container=document.createElement("a-reticle"),this._container.classList.add("arscene-reticle"),this._container.setAttribute("testing","false"),this._container.setAttribute("visible","false"),this._container.setAttribute("position","0 0 0"),this._container.setAttribute("rotation","0 0 0");const t=document.createElement("a-plane");t.setAttribute("rotation","-90 0 0"),t.setAttribute("width","0.2"),t.setAttribute("height","0.2"),t.setAttribute("src","/images/arrowTransparent.png"),t.setAttribute("material","transparent:true;"),this._container.appendChild(t),e.appendChild(this._container)}_registerPrimitive=e=>{this._registerComponent(e),AFRAME.primitives.primitives["a-reticle"]||AFRAME.registerPrimitive("a-reticle",{defaultComponents:{"ar-hit-test":{},rotation:{x:-90,y:0,z:0}},mappings:{target:e+".target",testing:e+".doHitTest"}})};_registerComponent=t=>{const s=this;AFRAME.components[t]||AFRAME.registerComponent(t,{schema:{target:{type:"selector"},doHitTest:{type:"boolean",default:!0}},init:function(){this.hitTest=null,this.hasFoundAPose=!1,this.onSessionEnd=()=>{this.hitTest=null,this.hasFoundAPose=!1},this.onSessionStart=async()=>{const e=this.el.sceneEl.renderer,t=this.session=e.xr.getSession(),s=await t.requestReferenceSpace("viewer"),i=new C(e,{space:s});this.hitTest=i},this.el.sceneEl.renderer.xr.addEventListener("sessionstart",this.onSessionStart),this.el.sceneEl.renderer.xr.addEventListener("sessionend",this.onSessionEnd)},tick:function(t,i){if(!this.data.doHitTest)return;const n=this.el.sceneEl.frame;if(!n)return;if(!this.hitTest)return;const o=this.hitTest.doHit(n);if(!o)return this.el.setAttribute("visible",!1),void s._success(!1);const{pose:r,inputSpace:a}=o;try{this.currentControllerPose=n.getPose(a,this.el.sceneEl.renderer.xr.getReferenceSpace())}catch(t){console.error(e)}this.hasFoundAPose=!0,this.el.setAttribute("visible",!0),this.el.setAttribute("position",r.transform.position),this.el.object3D.quaternion.copy(r.transform.orientation),s._success(!0)},remove:function(){this.el.sceneEl.renderer.xr.removeEventListener("sessionstart",this.onSessionStart),this.el.sceneEl.renderer.xr.removeEventListener("sessionend",this.onSessionEnd)}})};_success=e=>{this._latestSuccess!=e&&(this._latestSuccess=e,e?this.trigger("success"):this.trigger("fail"))};position=()=>this._container.getAttribute("position");rotation=()=>this._container.getAttribute("rotation");show(){return this._success(!1),this._container.setAttribute("testing",!0),this}hide(){return this._container.setAttribute("visible",!1),this._container.setAttribute("testing",!1),this}remove(){this._cache.clear(),super.remove()}}class E extends s{_request=null;_container=null;_models=[];_position=null;_rotation=null;_dimensions=null;constructor(e,...t){super(),this._container=document.createElement("a-entity"),this._container.classList.add("ar-model"),this._request=new c,t.length&&this.update(...t),e.appendChild(this._container)}update=async(e,t=1,s=1)=>{this.hide();const i=this._request.model(e);this.clear();const n=[];for(let e=0;e<t;e++)n.push(this._addModel(i,s));return Promise.all(n).then((()=>{this._dimensions=this._modelDimensions(),this.position().show()}))};position=(e,t)=>{if(e?this._position=e:e=this._position,t?this._rotation=t:t=this._rotation,!e||!t)return this;const s=this._models.length,i=Math.ceil(Math.pow(s,1/3)),n=i**2,o=this._dimensions,r=e.clone().setX(e.x-o.xOffset-i*o.width/2).setY(e.y-o.yOffset).setZ(e.z-o.zOffset-i*o.depth/2),a=r.clone();for(let e=0;e<this._models.length;e++){const s=e%i,l=~~(e/n),h=~~(e/i)%i;a.setX(r.x+s*o.width).setY(r.y+l*o.height).setZ(r.z+h*o.depth);const c=this._models[e];c.setAttribute("position",a),c.setAttribute("rotation",t)}return this};_modelDimensions=()=>{const e=this._models[0];if(e){const t=new AFRAME.THREE.Box3;return t.setFromObject(e.object3D),{width:t.max.x-t.min.x,height:t.max.y-t.min.y,depth:t.max.z-t.min.z,xOffset:t.min.x,yOffset:t.min.y,zOffset:t.min.z}}return{width:1,height:1,depth:1,xOffset:0,yOffset:0,zOffset:0}};_addModel=async(e,t)=>new Promise(((s,i)=>{const n=document.createElement("a-gltf-model");n.classList.add("arscene-object"),n.setAttribute("visible","true"),n.object3D.scale.set(t,t,t),this._container.appendChild(n),this._models.push(n),n.addEventListener("model-loaded",s),n.setAttribute("src",e)}));_removeModel=()=>{this._models.pop().remove()};clear=()=>{for(;this._models.length;)this._removeModel();return this};show(){super.show();for(const e of this._models)e.setAttribute("visible","true");return this}hide(){super.hide();for(const e of this._models)e.setAttribute("visible","false");return this}remove(){this._request&&this._request.remove();for(const e of this._models)e.remove();this._models=[],super.remove()}}const T=(e,t)=>{let s;return function(){const i=this,n=arguments,o=()=>{s=null,e.apply(i,n)};clearTimeout(s),s=setTimeout(o,t)}};class S{_targets=new Map;_observer=null;constructor(){this._observer=new MutationObserver((e=>{for(const t of e){if("attributes"!=t.type)return;this._targets.has(t.target)&&this._targets.get(t.target)(t)}}))}on(e,t){if(!(!e instanceof Element))return this._targets.set(e,t),this._observer.observe(e,{attributes:!0}),this}remove(){this._observer&&(this._observer.disconnect(),this._observer=null,this._targets.clear())}}class L extends s{_mode="inactive";_scene=null;_reticle=null;_model=null;_assets=null;_overlay=null;_overlayContainer=null;_interface=null;_proceedButton=null;_stopButton=null;_instructions=null;_overlayTitle;_texts=null;_observer=null;_product=null;_modelIndex=-1;constructor(e,t){super(),this._texts=t,this._initInterface(e)}_initInterface=e=>{this._container=document.createElement("div"),this._container.classList.add("arscene"),this._createOverlay(this._container),this._createScene(this._container),this.hide(),e.appendChild(this._container)};_createScene=e=>{this._scene=document.createElement("a-scene"),this._scene.classList.add("arscene-scene"),this._scene.setAttribute("visible","false"),this._scene.setAttribute("vr-mode-ui","enabled: false"),this._scene.setAttribute("webxr","optionalFeatures: hit-test, local-floor, dom-overlay; overlayElement: .arscene-overlay;"),this._reticle=new x(this._scene),this._startReticleSync(),this._addOverlayToScene(this._scene),this._model=new E(this._scene).hide(),e.prepend(this._scene),this._preventClass("html","a-fullscreen"),this._scene.renderStarted?this._initScene():this._scene.addEventListener("loaded",(()=>{this._initScene()}))};_preventClass=(e,t)=>{const s=document.getElementsByTagName(e)[0];this._observer=new S,this._observer.on(s,(e=>{"class"==e.attributeName&&s.classList.contains(t)&&(s.classList.remove(t),this._observer.remove())}))};_initScene=()=>{this._scene.addEventListener("exit-vr",(()=>{this.stop()})),this._scene.addEventListener("enter-vr",(()=>{this._activateScene()})),this.trigger("loaded")};_activateScene=()=>{if(this._scene.is("vr-mode"))return this._handleError("VR mode is not yet implemented.");if(!this._scene.is("ar-mode"))return this._handleError("Could not enter augmented reality mode.");const e=!(!this._scene.xrSession.domOverlayState||!this._scene.xrSession.domOverlayState.type);this._overlayContainer.setAttribute("text","value","Overlay: "+e),this._overlayContainer.setAttribute("visible","true"),this._scene.setAttribute("visible","true"),this._placeModel()};_handleError=e=>{this.trigger("error",e)};_addOverlayToScene=e=>{const t=document.createElement("a-camera");this._interface=document.createElement("a-entity"),this._interface.classList.add("arscene-interface"),this._interface.setAttribute("text","align: left; width: 0.1;"),this._interface.setAttribute("position","0 0 -0.25;"),this._interface.setAttribute("visible","false"),t.appendChild(this._interface),e.appendChild(t)};_createOverlay=e=>{this._overlayContainer=document.createElement("div"),this._overlayContainer.classList.add("arscene-overlay"),this._overlay=new w(this._overlayContainer),this._overlayTitle=this._overlay.add("h1",{location:"top"}),this._instructions=this._overlay.add("p",{location:"top"}),this._proceedButton=this._overlay.add("button"),this._allowProceed(),this._stopButton=this._overlay.add("button",{text:this._texts["exit-button"]||"Exit"});const t=T((()=>{this._scene.xrSession.end()}),500);this._stopButton.addEventListener("mousedown",t),this._stopButton.addEventListener("touchstart",t),e.appendChild(this._overlayContainer)};_placeModel=()=>{this._startReticleSync(),this._modelIndex=-1,this._reticle.show(),this._model.hide(),this._overlayTitle.textContent=this._texts["placing-title"]||"",this._instructions.textContent=this._texts["placing-description"]||"",this._proceedButton.textContent=this._texts["placing-button"]||"Place"};_showModel=()=>{this._stopReticleSync();const e=this._product.models[this._modelIndex];this._model.update(e._id,e.multiplier,e.scale).then((()=>{0==this._modelIndex&&(this._reticle.hide(),this._model.position(this._reticle.position(),this._reticle.rotation()).show())})),this._overlayTitle.textContent=e["viewing-title"]||"",this._instructions.textContent=e["viewing-description"]||"",this._proceedButton.textContent=e["viewing-button"]||"Proceed"};active=()=>this._scene.renderStarted;proceed=()=>(this._modelIndex+=1,this._modelIndex<this._product.models.length?this._showModel():this._placeModel(),this);_proceedHandler=T((()=>{this.proceed()}),500);_startReticleSync=()=>{this._preventProceed(),this._reticle.on("success",this._allowProceed).on("fail",this._preventProceed)};_stopReticleSync=()=>{this._reticle.off("success",this._allowProceed).off("fail",this._preventProceed),this._allowProceed()};_preventProceed=()=>{this._proceedButton.removeEventListener("mousedown",this._proceedHandler),this._proceedButton.removeEventListener("touchstart",this._proceedHandler),this._proceedButton.disabled=!0};_allowProceed=()=>{this._proceedButton.addEventListener("mousedown",this._proceedHandler),this._proceedButton.addEventListener("touchstart",this._proceedHandler),this._proceedButton.disabled=!1};select=e=>{this._product=e;try{this._scene.enterAR(),this.show()}catch(e){this._handleError(e)}return this};stop=()=>(this._reticle.hide(),this.trigger("end"),this);_stopHandler=T((()=>{this.stop()}),500);show(){return this._reticle.show(),super.show(),this}hide(){return this._reticle.hide(),super.hide(),this}remove(){this.stop(),this._overlay&&this._overlay.remove(),this._reticle&&this._reticle.remove(),this._observer&&this._observer.remove(),this._scene&&this._scene.remove(),this._model&&this._model.remove(),this._assets&&this._assets.remove(),this._overlayContainer&&this._overlayContainer.remove(),this._interface&&this._interface.remove(),this._proceedButton&&this._proceedButton.remove(),this._stopButton&&this._stopButton.remove(),this._instructions&&this._instructions.remove(),super.remove()}}class A extends t{_toLoad=[];_loading=new Map;_loaded=new Map;_failed=new Map;_head=null;constructor(e){super(),this._head=document.getElementsByTagName("head")[0],e&&this.loadAll(e)}_loadHandler=e=>{const t=e.target,s=t.slug;this._loading.delete(s),this._loaded.set(s,t),this.trigger("loaded",{path:s,element:t}),this._toLoad.length||this._loading.size||this._failed.size||this.trigger("loaded-all")};_errorHandler=e=>{const t=e.target,s=t.slug;this._loading.delete(s),this._failed.set(s,t),this.trigger("failed",{path:s,tag:t})};_alreadyLoaded=e=>document.querySelector(`script[src*="${e}"]`);loadAll=e=>{this._toLoad=e;for(const t of e)this.load(t);return this};load=e=>{if(this._loading.has(e)||this._loaded.has(e))return;this._failed.has(e)&&this._failed.delete(e);const t=this._alreadyLoaded(e);if(t)return this._toLoad=this._toLoad.filter((t=>e!=t)),this._loadHandler({target:t}),this;const s=document.createElement("script");return s.type="text/javascript",s.onerror=this._errorHandler,s.onload=this._loadHandler,this._toLoad=this._toLoad.filter((t=>e!=t)),this._loading.set(e,s),this._head.appendChild(s),s.src=e,s.slug=e,this};remove(){this._toLoad=[],this._head=null,this._loaded.clear(),this._loading.clear(),this._failed.clear(),super.remove()}}class P extends s{_request=null;_scene=null;_scanner=null;_scriptLoader=null;_products={};_productsPromise=null;_shownProduct=null;_productDisplay=null;_selectButton=null;_texts=null;_textsPromise=null;constructor(e,t={}){super();this._scriptLoader=new A,this._request=new c,this._loadProducts(t.appPath),this._loadTexts(t.appPath),this._scriptLoader.on("loaded-all",(e=>{this._textsPromise.then((e=>{if(e)return e.json().then((e=>{this._texts=e,this._enableFullscreen(),this._loadBarcodeScanner(),this._loadArScene(),this._getProductFromUrl()}))}))})),this._scriptLoader.loadAll(["/quagga/quagga.min.js","/aframe/aframe.min.js"]),this._container=document.createElement("div"),this._container.classList.add("representation"),e.appendChild(this._container)}_getProductFromUrl=()=>{const e=new URL(window.location.href).searchParams.get("product");this._productsPromise.then((()=>{this._processBarcode({code:e})}))};_enableFullscreen=()=>{document.getElementsByTagName("html")[0].classList.add("fullscreen")};_disableFullscreen=()=>{document.getElementsByTagName("html")[0].classList.remove("fullscreen")};_loadArScene=()=>{this._scene=new L(this._container,this._texts),this._scene.on("error",(e=>{this.trigger("error",e)})),this._scene.on("end",this._onSceneEnd);const e=T(this._selectProduct,500);this._scene.on("loaded",(()=>{this._selectButton.addEventListener("click",e),this._selectButton.addEventListener("touchend",e),this._shownProduct&&(this._selectButton.disabled=!1)}))};_onSceneEnd=()=>{this._scene.hide(),this._scanner.start().show()};_loadBarcodeScanner=()=>{this._scanner=new y(this._container),this._scanner.on("error",(()=>{this.trigger("error","Error: could not access camera")})),this._scanner.on("scanned",this._processBarcode);const e=this._scanner.overlay();this.pageTitle(this._texts.name),e.add("h1",{text:this._texts["scanning-title"],location:"top"}),e.add("p",{text:this._texts["scanning-description"],location:"top"}),this._productDisplay=e.add("p",{animated:!0}),this._selectButton=e.add("button",{text:this._texts["scanning-button"]||"Select"}),this._selectButton.disabled=!0};_selectProduct=e=>{this._scanner.stop().hide(),this._scene.select(this._shownProduct)};_processBarcode=e=>{e.code in this._products&&(this._shownProduct&&e.code==this._shownProduct.barcode||(this._shownProduct=this._products[e.code],this._productDisplay.textContent="",setTimeout((()=>{this._productDisplay.textContent=this._shownProduct.name}),200),this._scene.active()&&(this._selectButton.disabled=!1)))};_loadProducts=e=>{this._productsPromise=this._request.get("/app/"+e+"/products").catch((e=>{this.trigger("error",e)})).then((e=>{if(e)return e.json().then((e=>{for(const t of e)this._products[t.barcode]=t}))}))};_loadTexts=e=>{this._textsPromise=this._request.get("/app/"+e).catch((e=>{this.trigger("error",e)}))};show(){return this._enableFullscreen(),super.show(),this}hide(){return this._disableFullscreen(),super.hide(),this}remove(){this.hide(),this._scene&&this._scene.off("end",this._onSceneEnd),this._scanner&&this._scanner.remove(),this._scene&&this._scene.remove(),this._request&&this._request.remove(),this._scriptLoader&&this._scriptLoader.remove(),this._productDisplay&&this._productDisplay.remove(),this._selectButton&&this._selectButton.remove(),this._productsPromise&&this._productsPromise.then((()=>{delete this._products,this._productsPromise=null})),this._shownProduct&&delete this._shownProduct,super.remove()}}class q extends s{_message=null;_buttonContainer=null;_buttons=[];constructor(e={}){if(super(),this._container=document.createElement("div"),this._container.classList.add("confirmation"),this._message=document.createElement("div"),this._message.classList.add("message"),this._container.appendChild(this._message),e.title){const t=document.createElement("h1");t.textContent=e.title,this._message.appendChild(t)}if(e.description){const t=document.createElement("p");t.textContent=e.description,this._message.appendChild(t)}document.body.appendChild(this._container)}addButton=e=>{this._buttonContainer||(this._buttonContainer=document.createElement("div"),this._buttonContainer.classList.add("buttons"),this._message.appendChild(this._buttonContainer));const t=new u(this._buttonContainer,e);return this._buttons.push(t),t};remove(){if(this._buttons)for(const e of this._buttons)e.remove();this._message&&this._message.remove(),this._buttonContainer&&this._buttonContainer.remove(),this._buttons=[],super.remove()}}class O extends s{_title=null;_description=null;_buttonContainer=null;_buttons=[];constructor(e,t={}){if(super(),this._container=document.createElement("div"),this._container.classList.add("card"),this.title(t.title),this.description(t.description),t.viewable&&this.addButton({label:"View",type:"default"}).on("click",(()=>{this.trigger("view",t.id)})),t.editable&&this.addButton({label:"Edit",type:"default"}).on("click",(()=>{this.trigger("edit",t.id)})),t.removable&&this.addButton({label:"Remove",type:"remove"}).on("click",(()=>{this._removeHandler(t.id)})),t.buttons)for(const e of t.buttons)this.addButton(e);e.appendChild(this._container)}_removeHandler=e=>{const t=new q({title:"Are you sure you want to remove this item?",description:"You are about to permanently remove this item. This action is irreversible."});t.addButton({label:"Yes",type:"confirm"}).on("click",(()=>{t.remove(),this.trigger("remove",e)})),t.addButton({label:"No",type:"cancel"}).on("click",(()=>{t.remove()}))};title=e=>(this._title||(this._title=new v(this._container,{type:"h2"})),e&&this._title.update(e),this);description=e=>(this._description||(this._description=document.createElement("p"),this._container.appendChild(this._description)),e&&(this._description.textContent=e),this);addButton=e=>{this._buttonContainer||(this._buttonContainer=document.createElement("div"),this._buttonContainer.classList.add("buttons"),this._container.appendChild(this._buttonContainer));const t=new u(this._buttonContainer,e);return this._buttons.push(t),t};remove(){if(this._title&&this._title.remove(),this._buttons)for(const e of this._buttons)e.remove();this._description&&this._description.remove(),this._buttonContainer&&this._buttonContainer.remove(),this._buttons=[],super.remove()}}class k extends s{_title=null;_errorDisplay=null;_cards=[];constructor(e,t={}){if(super(),this._container=document.createElement("div"),this._container.classList.add("overview"),t.title&&this.title(t.title),this._errorDisplay=new f(this._container),t.center&&this._container.classList.add("center"),t.cards)for(const e of t.cards)this.addCard(e);e.appendChild(this._container)}title=e=>(this._title?e?this._title.update(e):this._title.remove():e&&(this._title=new v(this._container,{title:e})),document.getElementsByTagName("title")[0].textContent=e,this);addCard=(e={})=>{const t=new O(this._container,e);return this._cards.push(t),t.bubbleTo(this),t};showError=e=>{const t=e instanceof Error?e.message:e;return this._errorDisplay.clear().add(t),this};remove(){if(this._title&&this._title.remove(),this._cards)for(const e of this._cards)e.remove();this._title=null,this._cards=[],super.remove()}}class B extends s{_container=null;_overview=null;_request=null;_requestPromise=null;constructor(e){super(),this._container=document.createElement("div"),this._container.classList.add("applist","component"),this._request=new c;const t="App overview";this.pageTitle(t),this._overview=new k(this._container,{title:t,center:!0}),this._requestPromise=this._request.get("/apps").catch((e=>{this._overview.showError(e)})).then((e=>{if(e)return e.json().then((t=>{if(!e.ok)return this._overview.showError(t.error);const s={},n={};for(const e of t){const t=this._overview.addCard({id:e._id,title:e.name,description:e.description,removable:!0,editable:!0,viewable:!0});s[e._id]=t,n[e._id]=e.path}this._overview.on("remove",(e=>{this._request.delete("/app/"+e).catch((e=>{this._overview.showError(e)})).then((t=>{t.ok&&s[e].remove()}))})),this._overview.on("edit",(e=>{i("/admin/app/"+e)})),this._overview.on("view",(e=>{i("/app/"+n[e])}))}))})),e.appendChild(this._container)}remove(){this._requestPromise&&this._requestPromise.then((()=>{this._overview.remove()})),super.remove()}}class j extends s{_container=null;_form=null;constructor(e,t={}){super();const s=t.appId?{put:"/app/"+t.appId,get:"/app/"+t.appId}:{post:"/app"};this._container=document.createElement("div"),this._container.classList.add("appform","component");const n=t.appId?"App configuration":"App creation";this.pageTitle(n),this._form=new b(this._container,{title:n,center:!0,params:s,inputs:[{name:"name",options:{label:"Name",type:"text",tooltip:"Give your app a name. This name is also visible to users in the browser tab.",required:!0}},{name:"description",options:{label:"Description",type:"textarea",tooltip:"Give your app a description. This description is only visible to you."}},{name:"path",options:{label:"Path",type:"text",tooltip:"Give your app a path. This is the last part of the URL where the app will appear. It has to be unique.",required:!0}},{name:"exit-button",options:{label:"Exit button",type:"text",tooltip:"In the augmented reality scene, an app always has a button that allows the user to exit the scene. Here you can decide the text for this button.",required:!0}}],fieldsets:[{name:"scanning",options:{legend:"Texts in scanning mode",tooltip:"These are the texts that will appear when a user is scanning a product.",inputs:[{name:"title",options:{label:"Title",type:"text",tooltip:"This is the title that will appear when a user is scanning a product."}},{name:"description",options:{label:"Description",type:"textarea",tooltip:"This is the description that will appear when a user is scanning a product. This is the perfect place to give the user hints for how to scan a product."}},{name:"button",options:{label:"Button",type:"text",tooltip:"This is the text for the button that the user uses to select a product that they have scanned. By clicking this button, the user enters the augmented reality scene.",required:!0}}]}},{name:"placing",options:{legend:"Texts in placing mode",tooltip:"These are the texts that will appear when a user is detecting surfaces on which to place the 3D models.",inputs:[{name:"title",options:{label:"Title",type:"text",tooltip:"This is the title that will appear when a user is detecting surfaces on which to place the 3D models."}},{name:"description",options:{label:"Description",type:"textarea",tooltip:"This is the description that will appear when a user is detecting surfaces on which to place the 3D models. This is the perfect place to give the user hints for how to detect a surface."}},{name:"button",options:{label:"Button",type:"text",tooltip:"This is the text for the button that the user uses to select a surface that they have detected. By clicking this button, the user places the first 3D model.",required:!0}}]}}],buttons:[{name:"submit",options:{label:t.appId?"Edit app":"Create app",type:"submit"}}]}),this._form.on("stored",(()=>{this.trigger("clearCache",[j,B]),i("/admin/apps")})),e.appendChild(this._container)}remove(){this._form.remove(),super.remove()}}class R extends s{_container=null;_overview=null;_request=null;_requestPromise=null;constructor(e){super(),this._container=document.createElement("div"),this._container.classList.add("modellist","component"),this._request=new c;const t="Model overview";this.pageTitle(t),this._overview=new k(this._container,{title:t,center:!0}),this._requestPromise=this._request.get("/models").catch((e=>{this._overview.showError(e)})).then((e=>{if(e)return e.json().then((t=>{if(!e.ok)return this._overview.showError(t.error);const s={};for(const e of t){const t=this._overview.addCard({id:e._id,title:e.name,description:e.description,removable:!0,editable:!0,viewable:!1});s[e._id]=t}this._overview.on("remove",(e=>{this._request.delete("/model/"+e).catch((e=>{this._overview.showError(e)})).then((t=>{t.ok&&s[e].remove()}))})),this._overview.on("edit",(e=>{i("/admin/model/"+e)}))}))})),e.appendChild(this._container)}remove(){this._requestPromise&&this._requestPromise.then((()=>{this._overview.remove()})),super.remove()}}class F extends s{_container=null;_form=null;_request=null;_requestPromise=null;constructor(e,t={}){super(),this._container=document.createElement("div"),this._container.classList.add("modelform","component"),this._request=new c,this._createForm(t),e.appendChild(this._container)}_createForm=e=>{const t=e.modelId?{put:"/model/"+e.modelId,get:"/model/"+e.modelId}:{post:"/model"},s=e.modelId?"Model configuration":"Model creation";this.pageTitle(s),this._form=new b(this._container,{title:s,center:!0,params:t,inputs:[{name:"name",options:{label:"Name",type:"text",tooltip:"Give your model a name. This name is only visible to you.",required:!0}},{name:"model",options:{label:"Upload model ...",accept:".glTF,.zip,.glb",type:"file",tooltip:"Click this button to select the model to upload. This can be a single file with a .glTF or .glb extension, or a .zip directory that contains an FBX, OBJ, or GLTF model and its dependencies."}},{name:"multiplier",options:{label:"Multiplier",type:"number",tooltip:"You can set a multiplier of 1 or greater. If you select 2 or more, the app will display the 3D model multiple times and try to stack them in a cube-like fashion.",set:1}},{name:"scale",options:{label:"Scale",type:"number",tooltip:"You can set a scaling factor for the model here. If set to 1, the app will show the model at its native size. Any values greater than 1 will increase the model's size. Values between 0 and 1 will shrink the model, and values below 0 will turn the model upside down.",step:"any"}}],fieldsets:[{name:"viewing",options:{legend:"Texts in viewing mode",tooltip:"While this model is being displayed, you can also make texts appear on the page. Here you can determine those texts.",inputs:[{name:"title",options:{label:"Title",type:"text",tooltip:"Set the title to show while this model is being displayed."}},{name:"description",options:{label:"Description",type:"textarea",tooltip:"Set the description to show while this model is being displayed."}},{name:"button",options:{label:"Button",type:"text",tooltip:"Set the text for the button that the user can press to see the next model. If there is no next model, the button press will return the user to the surface detection mode.",required:!0}}]}}],buttons:[{name:"submit",options:{label:e.modelId?"Edit model":"Create model",type:"submit"}}]}),this._form.on("stored",(()=>{this.trigger("clearCache",[F,R]),i("/admin/models")}))};remove(){this._form.remove(),super.remove()}}class I extends s{_container=null;_overview=null;_request=null;_requestPromise=null;constructor(e){super(),this._container=document.createElement("div"),this._container.classList.add("productlist","component"),this._request=new c;const t="Product overview";this.pageTitle(t),this._overview=new k(this._container,{title:t,center:!0}),this._requestPromise=this._request.get("/products").catch((e=>{this._overview.showError(e)})).then((e=>{if(e)return e.json().then((t=>{if(!e.ok)return this._overview.showError(t.error);const s={};for(const e of t){const t=this._overview.addCard({id:e._id,title:e.name,description:e.description,removable:!0,editable:!0,viewable:!1});s[e._id]=t}this._overview.on("remove",(e=>{this._request.delete("/product/"+e).catch((e=>{this._overview.showError(e)})).then((t=>{t.ok&&s[e].remove()}))})),this._overview.on("edit",(e=>{i("/admin/product/"+e)}))}))})),e.appendChild(this._container)}remove(){this._requestPromise&&this._requestPromise.then((()=>{this._overview.remove()})),super.remove()}}class D extends s{_container=null;_form=null;_modelsSelect=null;_productsSelect=null;_request=null;_modelsRequest=null;_appsRequest=null;constructor(e,t={}){super(),this._container=document.createElement("div"),this._container.classList.add("productform","component"),this._request=new c,this._createForm(t),e.appendChild(this._container),this._modelsRequest=this._request.get("/models").catch((e=>{this._form.showError(e)})).then((e=>{e&&e.json().then((t=>{if(!e.ok)return this._form.showError(t.error);for(const e of t)this._modelsSelect.addOption(e._id,e.name)}))})),this._appsRequest=this._request.get("/apps").catch((e=>{this._form.showError(e)})).then((e=>{e&&e.json().then((t=>{if(!e.ok)return this._form.showError(t.error);for(const e of t)this._appsSelect.addOption(e._id,e.name)}))}))}_createForm=e=>{const t=e.productId?{put:"/product/"+e.productId,get:"/product/"+e.productId}:{post:"/product"},s=e.productId?"Product configuration":"Product creation";this.pageTitle(s),this._form=new b(this._container,{title:s,center:!0,params:t,inputs:[{name:"name",options:{label:"Name",type:"text",tooltip:"Give your product a name. This name is also visible to users who scan this product.",required:!0}},{name:"barcode",options:{label:"Barcode",type:"number",tooltip:"Enter the product's barcode. It is important that this is entered accurately, or the user won't be able to scan the product!",required:!0}}]}),this._modelsSelect=this._form.addInput("models",{label:"Models",placeholder:"Select model ...",tooltip:"Select the models to display for this product. You can select multiple models per product. They will appear to the user in the order that is displayed here; the first model you add will be the first model the user sees.",type:"multiselect"}),this._appsSelect=this._form.addInput("app",{placeholder:"Select app ..",tooltip:"Select the app to which to add this product. You cannot add more than one product to an app with the same barcode.",type:"select"}),this._form.addButton("submit",{label:e.productId?"Edit product":"Create product",type:"submit"}),this._form.on("stored",(()=>{this.trigger("clearCache",[D,I]),i("/admin/products")}))};remove(){Promise.all([this._modelsRequest,this._appsRequest]).then((()=>{this._form.remove()})),super.remove()}}const M=document.body;new class extends s{_pages=null;constructor(e,t={}){super(),this._container=document.createElement("div"),this._container.classList.add("menu");const s=document.createElement("nav");s.classList.add("navigation");const i=document.createElement("div");i.classList.add("shortcuts"),this._pages=t.pages,this._addAnchors(s,t.navigation),this._addAnchors(i,t.shortcuts),window.addEventListener("popstate",this._processPathChange),this._processPathChange(),this._container.appendChild(s),this._container.appendChild(i),e.prepend(this._container)}_processPathChange=e=>{const t=window.location.pathname;for(const e of this._pages)if(t.startsWith(e))return this.show();return this.hide()};_addAnchors=(e,t)=>{for(const[s,n]of t){const t=document.createElement("a");t.classList.add("button"),t.setAttribute("href",n),t.textContent=s,t.addEventListener("click",(e=>{e.preventDefault(),i(n)})),e.append(t)}};remove(){window.removeEventListener("popstate",this._processPathChange),super.remove()}}(M,{pages:["/admin"],navigation:new Map([["Apps","/admin/apps"],["Products","/admin/products"],["Models","/admin/models"],["Profile","/admin/profile"],["Log out","/logout"]]),shortcuts:new Map([["Add app","/admin/app/new"],["Add product","/admin/product/new"],["Add model","/admin/model/new"]])});const H=new class extends s{_cacheSize=null;_widgets=new Map;constructor(e,t={}){super(),this._cacheSize=t.cacheSize>1?t.cacheSize:1,this._container=document.createElement("div"),this._container.classList.add("view"),t.Widget&&this.install(t.Widget,...t.params),e.appendChild(this._container)}install(e,...t){if(!this._widgets.has(e)){const s=this._activeWidget();s&&s.instance.hide();const i=new e(this._container,...t);i.on("clearCache",this._removeWidgets),i.bubbleTo(this),this._widgets.set(e,{instance:i,params:t}),this._widgets.size>this._cacheSize&&this._cullWidget()}return this._activate(e,t),this}_activeWidget(){return!!this._widgets.size&&Array.from(this._widgets).pop()[1]}_activate(e,t){if(!e)return;this._activeWidget().instance.hide();const s=this._widgets.get(e);this._widgets.delete(e),n(s.params,t)||(s.params=t,s.instance.remove(),s.instance=new e(this._container,...t)),this._widgets.set(e,s),s.instance.show()}_cullWidget(){const[e,t]=Array.from(this._widgets)[0];this._widgets.delete(e),t.instance.remove()}_removeWidgets=e=>{if(void 0===e)return this.clear();for(const t of e)this._removeWidget(t)};_removeWidget=e=>{if(!e)return;const t=this._widgets.get(e);t&&(this._widgets.delete(e),t.instance.remove())};clear(){for(const[e,t]of this._widgets)t.instance.remove();return this._widgets.clear(),this}remove(){this.clear(),super.remove()}}(M,{cacheSize:15,Widget:h,params:["Loading..."]}).on("error",(e=>{H.install(h,e)}));new class extends t{_routes=new Map;_protected=[];constructor(e=new Map,t={}){super();for(const t of e.keys())this.add(t,e.get(t));this._protected=t.protected,window.addEventListener("popstate",this.navigateToCurrent)}navigateToCurrent=()=>(this.navigateTo(window.location.pathname),this);_loggedIn=()=>!!l().xsrfToken;navigateTo=e=>{if(!(this._loggedIn()||!0))for(const t of this._protected)if(e.startsWith(t))return this.trigger("not-allowed");for(const[t,s]of this._routes.entries()){const t=e.match(s.pattern);if(!t)continue;const i={};t.shift();for(let e=0;e<t.length;e++)i[s.variables[e]]=t[e];return this.trigger("navigate",{component:s.component,options:Object.assign({},s.options,i)})}return this.trigger("not-found")};add=(e,t,s)=>{const i=[];let n="^";for(const t of e.substring(1).split("/"))n+="/",t.startsWith(":")?(i.push(t.substring(1)),n+="([^/]+)"):n+=t;return n+="/?$",this._routes.set(e,{component:t,pattern:n,options:s,variables:i}),this};delete=e=>(this._routes.delete(e),this);clear=()=>(this._routes.clear(),this);remove(){window.removeEventListener("popstate",this.navigateToCurrent),super.remove()}}(new Map([["/app/:appPath",class extends s{_container=null;constructor(e,t={}){super(),this._container=document.createElement("div"),this._container.classList.add("app"),this._representation=new P(this._container,t),this._representation.on("error",(e=>{this.trigger("error",e)})),e.appendChild(this._container)}show(){return this._representation.show(),super.show(),this}hide(){return this._representation.hide(),super.hide(),this}remove(){this._representation.remove(),super.remove()}}],["/",g],["/login",g],["/logout",class extends s{_container=null;_request=null;_apology=null;constructor(e){super(),this._container=document.createElement("div");const t="Logging out.";this.pageTitle(t),this._apology=new h(this._container,t),this._request=new c,this._request.get("/logout").catch((e=>{this._apology.update("Error occurred: could not log out.")})).then((e=>{if(!e)return this._apology.update("Error occurred: could not log out.");window.location.href="/login"})),e.appendChild(this._container)}remove(){this._form.remove(),super.remove()}}],["/register",class extends s{_container=null;_form=null;constructor(e,t={}){super(),this._container=document.createElement("div"),this._container.classList.add("registration","component");const s="Registration";this.pageTitle(s),this._form=new b(this._container,{title:s,center:!0,params:{post:"/user"},inputs:[{name:"email",options:{label:"Email address",type:"email",required:!0}},{name:"password",options:{label:"Password",type:"password",required:!0}},{name:"repeat",options:{label:"Repeat password",type:"password",required:!0}}],buttons:[{name:"submit",options:{label:"Register",type:"submit"}}]}),this._form.on("stored",(()=>{i("/login")}));const n=document.createElement("a");n.addEventListener("click",(()=>{i("/login")})),n.textContent="Already an account? Login here.";const o=document.createElement("p");o.appendChild(n),this._container.appendChild(o),e.appendChild(this._container)}remove(){this._form.remove(),super.remove()}}],["/admin",B],["/admin/apps",B],["/admin/app/new",j],["/admin/app/:appId",j],["/admin/models",R],["/admin/model/new",F],["/admin/model/:modelId",F],["/admin/products",I],["/admin/product/new",D],["/admin/product/:productId",D],["/admin/profile",class extends s{_container=null;_form=null;constructor(e){super(),this._container=document.createElement("div"),this._container.classList.add("passwordform","component");const t="Change password";this.pageTitle(t),this._form=new b(this._container,{title:t,center:!0,params:{post:"/user/password"},inputs:[{name:"password",options:{label:"Password",type:"password"}},{name:"repeat",options:{label:"Repeat password",type:"password"}}],buttons:[{name:"submit",options:{label:"Change",type:"submit"}}]}),this._form.on("stored",(()=>{i("/admin/apps")})),e.appendChild(this._container)}remove(){this._form.remove(),super.remove()}}]]),{protected:["/admin"]}).on("navigate",(e=>{H.install(e.component,e.options)})).on("not-found",(()=>{H.install(h,"This page could not be found.",{text:"Visit login",location:"/login"})})).on("not-allowed",(()=>{H.install(h,"You are not allowed to view this page.",{text:"Visit login",location:"/login"})})).navigateToCurrent()}();