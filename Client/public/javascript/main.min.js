!function(){"use strict";class t{_triggers={};_bubbleTo=[];constructor(){}trigger=(t,e)=>{if(this._triggers[t]&&this._triggers[t].forEach((t=>{t(e)})),this._bubbleTo)for(const i of this._bubbleTo)i.trigger(t,e);return this};bubbleTo=e=>(!e instanceof t||this._bubbleTo.push(e),this);bubbleOff=e=>(!e instanceof t||(this._bubbleTo=this._bubbleTo.filter((t=>t!=e))),this);on=(t,e)=>(null==this._triggers[t]&&(this._triggers[t]=[]),this._triggers[t].push(e),this);off=(t,e)=>(null==this._triggers[t]||(this._triggers[t]=this._triggers[t].filter((t=>t!==e))),this);remove(){this._triggers={},this._bubbled=[]}}class i extends t{_container=null;_pageTitle=null;pageTitle(t){return this._pageTitle=t,document.getElementsByTagName("title")[0].textContent=t,this}show(){return this._container&&this._container.removeAttribute("hidden"),this._pageTitle&&this.pageTitle(this._pageTitle),this}hide(){return this._container&&this._container.setAttribute("hidden",""),this}remove(){this._container&&this._container.remove(),super.remove()}}const s=t=>{history.pushState({},"",t),dispatchEvent(new PopStateEvent("popstate",{state:{}}))};const n=(t,e)=>t==e||(t instanceof Map?a(t,e):t instanceof Array?r(t,e):t instanceof Object&&o(t,e)),o=(t,e)=>{if(!t instanceof Object||!e instanceof Object)return!1;const i=Object.entries(t);if(i.length!=Object.keys(e).length)return!1;if(0==i.length)return!0;for(const[t,s]of i){if(!e.hasOwnProperty(t))return!1;if(!n(s,e[t]))return!1}return!0},r=(t,e)=>{if(!t instanceof Array||!e instanceof Array)return!1;if(t.length!=e.length)return!1;if(0==t.length)return!0;for(let i=0;i<t.length;i++)if(!n(t[i],e[i]))return!1;return!0},a=(t,e)=>{if(!t instanceof Map||!e instanceof Map)return!1;if(t.size!=e.size)return!1;if(0==t.size)return!0;const i=t.keys(),s=t.values(),o=e.keys(),r=e.values();for(let e=0;e<t.size;e++){if(!n(i.next().value,o.next().value))return!1;if(!n(s.next().value,r.next.value))return!1}return!0};const l=()=>document.cookie.split("; ").reduce(((t,e)=>{const[i,s]=e.split("=");return t[i]=s,t}),{});class h extends i{_title=null;_text=null;constructor(t,e={}){super(),this._container=document.createElement("div"),this._container.classList.add("apology"),e.title&&(this._title=document.createElement("h1"),this._title.textContent=e.title,this._container.appendChild(this._title)),e.text&&(this._text=document.createElement("p"),this._text.textContent=e.text,this._container.appendChild(this._text)),e.link&&this.addLink(e.link.text,e.link.location),t.appendChild(this._container)}update=t=>(this._title.textContent=t,this);addLink=(t,e)=>{const i=document.createElement("a");i.classList.add("button"),"function"!=typeof e&&i.setAttribute("href",e),i.textContent=t,i.addEventListener("click",(t=>{t.preventDefault(),"function"==typeof e?e():s(e)})),this._container.appendChild(i)};remove(){this._title&&this._title.remove(),this._text&&this._text.remove(),super.remove()}}class c{_apiUrl="";_storageUrl="";constructor(){const t=window.location.protocol+"//"+window.location.host;this._apiUrl=t+"/api",this._storageUrl=t+"/models"}model=t=>this._storageUrl+"/"+t+".glb";_errorCheck=async t=>{const e=await t;if(429==e.status)throw new Error("Received too many requests. Try again later.");if(401==e.status)throw new Error("Request not allowed. You need to be logged in.");return e};_xsrfToken=()=>l().xsrfToken;get=async(t="")=>this._errorCheck(fetch(this._apiUrl+t,{method:"GET",mode:"cors",cache:"no-cache",credentials:"include",headers:{"Content-Type":"application/json","X-XSRF-TOKEN":this._xsrfToken()},redirect:"follow",referrerPolicy:"no-referrer"}));put=async(t="",e={})=>this._encodeFiles(e).then((e=>this._errorCheck(fetch(this._apiUrl+t,{method:"PUT",mode:"cors",cache:"no-cache",credentials:"include",headers:{"Content-Type":"application/json","X-XSRF-TOKEN":this._xsrfToken()},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(e)}))));post=async(t="",e={})=>this._encodeFiles(e).then((e=>this._errorCheck(fetch(this._apiUrl+t,{method:"POST",mode:"cors",cache:"no-cache",credentials:"include",headers:{"Content-Type":"application/json","X-XSRF-TOKEN":this._xsrfToken()},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(e)}))));delete=async(t="")=>this._errorCheck(fetch(this._apiUrl+t,{method:"DELETE",mode:"cors",cache:"no-cache",credentials:"include",headers:{"Content-Type":"application/json","X-XSRF-TOKEN":this._xsrfToken()},redirect:"follow",referrerPolicy:"no-referrer"}));_encodeFiles=async t=>new Promise(((e,i)=>{try{const i={},s=[];for(const[e,n]of Object.entries(t))n instanceof File?s.push(this._encodeFile(n).then((t=>{i[e]=t}))):i[e]=n;Promise.all(s).then((()=>{e(i)}))}catch(t){i(t)}}));_encodeFile=async t=>new Promise(((e,i)=>{const s=new FileReader;s.onload=()=>{e({file:s.result,extension:t.name.split(".").pop()})},s.onerror=t=>{i(t)},s.onabort=t=>{i(t)},s.readAsDataURL(t)}));remove(){}}class d extends i{_options=[];constructor(t,e={}){if(super(),this._container=document.createElement("select"),this._container.addEventListener("change",(t=>{this.trigger("change",t)})),e.name&&(this._container.name=e.name),e.required&&this._container.setAttribute("required",!0),e.disabled&&this.disabled(e.disabled),e.multiple&&this._container.setAttribute("multiple",!0),e.tooltip&&this._container.setAttribute("title",e.tooltip),e.placeholder){const t=this.addOption("",e.placeholder);t.selected=!0,t.disabled=!0,t.hidden=!0}if(e.options)for(const t of e.options)this.addOption(t.value,t.label);t.appendChild(this._container)}value=t=>void 0===t?this._container.selectedOptions.length?this._container.selectedOptions[0].disabled?"":this._container.value:"":(this._container.value=t,this);labels=()=>[...this._container.selectedOptions].map((t=>t.textContent));disabled=t=>void 0===t?this._container.disabled:(this._container.disabled=t,this);addOption=(t,e)=>{if(!e)return;const i=document.createElement("option");return t&&(i.value=t),i.textContent=e,this._options.push(i),this._container.appendChild(i),i};clear=()=>{for(const t of this._options)t.remove();return this._options=[],this};remove(){this.clear(),super.remove()}}class u extends i{constructor(t,e={}){super(),this._container=document.createElement("button"),e.type&&this._container.setAttribute("type",e.type),e.label&&(this._container.textContent=e.label),e.disabled&&this.disabled(e.disabled),this._container.addEventListener("click",this._onClick),t.appendChild(this._container)}_onClick=t=>{this.trigger("click",t)};disabled=t=>void 0===t?this._container.disabled:(this._container.disabled=t,this);remove=()=>{this._container.removeEventListener("click",this._onClick),super.remove()}}class _ extends i{_selected=[];_options=[];_add=null;_clear=null;constructor(t,e={}){super(),this._container=document.createElement("fieldset"),e.tooltip&&this._container.setAttribute("title",e.tooltip);const i=document.createElement("div");if(i.classList.add("multiselect"),this._container.appendChild(i),e.label&&this.label(e.label),this._select=new d(i,{label:e.label}),e.options)for(const t of e.options)this.addOption(t);this._add=new u(i,{label:"Add",disabled:!0}).on("click",this.selectCurrent),this._select.on("change",this._checkAddState),this._selectionDisplay=document.createElement("div"),this._selectionDisplay.classList.add("selections"),i.appendChild(this._selectionDisplay),this._clear=new u(i,{label:"Clear",type:"reset",disabled:!0}).on("click",this.reset),t.appendChild(this._container)}label=t=>(this._legend?t?this._legend.textContent=t:this._legend.remove():t&&(this._legend=document.createElement("legend"),this._legend.textContent=t,this._container.prepend(this._legend)),this);_checkAddState=()=>{const t=this._select.value();if(!t)return this._add.disabled(!0);const e=this.value().includes(t);return this._add.disabled(e)};selectCurrent=t=>{t.preventDefault();const e=this._select.value(),i=this._select.labels()[0];return this.select(e,i)};reset=t=>(t.preventDefault(),this.clear());select=(t,e)=>{this._selected.push(t),this._checkAddState(),this._clear.disabled(!1);const i=document.createElement("p");return i.classList.add("selection"),i.textContent=e,this._selectionDisplay.appendChild(i),this};value=t=>{if(void 0===t)return this._selected;for(const e of t)this.select(e._id,e.name);return this};disabled=t=>void 0===t?this._container.disabled:(this._container.disabled=t,this._add.disabled=t,this._clear.disabled=t,this._select.disabled(t),this);addOption=(t,e)=>{const i=this._select.addOption(t,e);return this._options.push(i),this._checkAddState(),i};clear=()=>{for(this._selected=[],this._clear.disabled(!0);this._selectionDisplay.firstChild;)this._selectionDisplay.removeChild(this._selectionDisplay.lastChild);return this._checkAddState(),this};remove(){this.clear(),this._select&&this._select.remove(),super.remove()}}class p extends i{_select=null;_id=null;constructor(t,e={}){switch(super(),this._id="input-"+this._uuidv4(),e.type){case"textarea":this._createTextarea(t,e);break;case"file":this._createFileButton(t,e);break;case"select":this._createSelect(t,e);break;case"multiselect":this._createMultiSelect(t,e);break;default:this._createInput(t,e)}}_uuidv4=()=>([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)));_createInput=(t,e)=>{this._container=document.createElement("div"),this._container.classList.add("input-field"),e.tooltip&&this._container.setAttribute("title",e.tooltip),this._input=document.createElement("input"),this._input.id=this._id,this._input.name=e.name,this._input.setAttribute("type",e.type||"text"),this._input.setAttribute("placeholder",e.label),e.required&&this._input.setAttribute("required",!0),e.disabled&&this.disabled(e.disabled),e.step&&this._input.setAttribute("step",e.step),this._label=document.createElement("label"),this._label.setAttribute("for",this._id);const i=document.createElement("span");i.textContent=e.label,this._label.appendChild(i),this._container.appendChild(this._input),this._container.appendChild(this._label),t.appendChild(this._container)};_createTextarea=(t,e)=>{this._container=document.createElement("div"),this._container.classList.add("input-field"),e.tooltip&&this._container.setAttribute("title",e.tooltip),this._input=document.createElement("textarea"),this._input.id=this._id,this._input.name=e.name,this._input.setAttribute("type",e.type),this._input.setAttribute("placeholder",e.label),e.required&&this._input.setAttribute("required",!0),e.disabled&&this.disabled(e.disabled),this._label=document.createElement("label"),this._label.setAttribute("for",this._id);const i=document.createElement("span");i.textContent=e.label,this._label.appendChild(i),this._container.appendChild(this._input),this._container.appendChild(this._label),t.appendChild(this._container)};_createFileButton=(t,e)=>{this._container=document.createElement("div"),this._container.classList.add("file-button"),e.tooltip&&this._container.setAttribute("title",e.tooltip),this._input=document.createElement("input"),this._input.id=this._id,this._input.name=e.name,this._input.setAttribute("type",e.type),e.accept&&this._input.setAttribute("accept",e.accept),e.required&&this._container.setAttribute("required",!0),e.disabled&&this.disabled(e.disabled);const i=document.createElement("label");i.setAttribute("for",this._id);const s=document.createElement("span");s.textContent=e.label,i.appendChild(s),this._input.addEventListener("change",(()=>{const t=this._input.files;if(t.length){const e=t[0];i.textContent=`${e.name} (${e.size} bytes)`}else i.textContent=e.label})),this._container.appendChild(this._input),this._container.appendChild(i),t.appendChild(this._container)};_createSelect=(t,e)=>{this._container=new d(t,e)};_createMultiSelect=(t,e)=>{this._container=new _(t,e)};addOption=(...t)=>{if(!(!this._container instanceof d))return this._container.addOption(...t)};value=t=>this._container instanceof d||this._container instanceof _?void 0===t?this._container.value():(this._container.value(t),this):void 0===t?"file"==this._input.type?this._input.files[0]:this._input.value:(this._input.value=t,this);disabled=t=>this._container instanceof d?void 0===t?this._container.disabled():(this._container.disabled(t),this):void 0===t?this._input.disabled:(this._input.disabled=t,this)}class m extends i{_legend=null;_inputContainer=null;_inputs={};_fieldsets={};_buttons={};_prefix=null;constructor(t,e={}){if(super(),this._container=document.createElement("fieldset"),this._inputContainer=document.createElement("div"),this._inputContainer.classList.add("fieldset-inputs"),this._container.appendChild(this._inputContainer),e.legend&&this.legend(e.legend),e.tooltip&&this._container.setAttribute("title",e.tooltip),this._prefix=e.name+"-",e.inputs)for(const t of e.inputs)this.addInput(t.name,t.options);if(e.fieldsets)for(const t of e.fieldsets)this.addFieldset(t.name,t.options);if(e.buttons)for(const t of e.buttons)this.addButton(t.name,t.options);t.appendChild(this._container)}legend=t=>(this._legend?t?this._legend.textContent=t:this._legend.remove():t&&(this._legend=document.createElement("legend"),this._legend.textContent=t,this._container.prepend(this._legend)),this);addInput=(t,e={})=>{const i=this._prefix+t,s=new p(this._inputContainer,Object.assign({},e,{name:i}));return this._inputs[i]&&this._inputs[i].remove(),this._inputs[i]=s,s};addFieldset=(t,e={})=>{const i=this._prefix+t,s=new m(this._inputContainer,Object.assign({},e,{name:i}));return this._fieldsets[i]&&this._fieldsets[i].remove(),this._fieldsets[i]=s,s};addButton=(t,e={})=>{const i=this._prefix+t,s=new u(this._inputContainer,Object.assign({},e,{name:i}));return this._buttons[i]&&this._buttons[i].remove(),this._buttons[i]=s,s};values=t=>{if(void 0===t){const t={};for(const[e,i]of Object.entries(this._inputs))t[e]=i.value();for(const[e,i]of Object.entries(this._fieldsets))Object.assign(t,i.values());return t}for(const[e,i]of Object.entries(t)){const t=this._inputs[e];t&&t.value(i)}for(const e of Object.values(this._fieldsets))e.values(t);return this};disabled=t=>void 0===t?this._container.disabled:(this._container.disabled=t,this);remove(){if(this._legend&&this._legend.remove(),this._inputs)for(const t of Object.values(this._inputs))t.remove();if(this._fieldsets)for(const t of Object.values(this._fieldsets))t.remove();if(this._buttons)for(const t of Object.values(this._buttons))t.remove();super.remove()}}class v extends i{constructor(t,e){super(),this._container=document.createElement(e.type||"h1"),e.title&&(this._container.textContent=e.title),t.appendChild(this._container)}update=t=>(this._container.textContent=t,this)}class f extends i{constructor(t){super(),this._container=document.createElement("div"),this._container.classList.add("error-display"),t.appendChild(this._container)}add=t=>{if("string"!=typeof t)return;const e=document.createElement("p");return e.textContent="Error: "+t,this._container.appendChild(e),this};clear=()=>{for(;this._container.firstChild;)this._container.firstChild.remove();return this};remove=()=>{super.remove()}}class b extends i{_title=null;_errorDisplay=null;_inputs={};_fieldsets={};_buttons={};_params=null;_request=null;constructor(t,e={},i){if(super(),this._container=document.createElement("form"),this._request=new c,e.params&&(this._params=e.params),this._container.addEventListener("submit",this.submit),e.title&&this.title(e.title),this._errorDisplay=new f(this._container),e.center&&this._container.classList.add("center"),e.inputs)for(const t of e.inputs)this.addInput(t.name,t.options);if(e.fieldsets)for(const t of e.fieldsets)this.addFieldset(t.name,t.options);if(e.buttons)for(const t of e.buttons)this.addButton(t.name,t.options);e.params&&e.params.get&&this._request.get(e.params.get).then(this._prefill).catch((t=>this.showError(t))),t.appendChild(this._container)}title=t=>(this._title?t?this._title.update(t):this._title.remove():t&&(this._title=new v(this._container,{title:t})),this);addInput=(t,e={})=>{const i=new p(this._container,Object.assign({},e,{name:t}));return this._inputs[t]&&this._inputs[t].remove(),this._inputs[t]=i,i};addFieldset=(t,e={})=>{const i=new m(this._container,Object.assign({},e,{name:t}));return this._fieldsets[t]&&this._fieldsets[t].remove(),this._fieldsets[t]=i,i};addButton=(t,e={})=>{const i=new u(this._container,Object.assign({},e,{name:t}));return this._buttons[t]&&this._buttons[t].remove(),this._buttons[t]=i,i};submit=t=>{t&&t.preventDefault();const e=this.values();if(this.trigger("submit",e),this._params)return this._params.put?this._request.put(this._params.put,e).then(this._submitResponseHandler).catch((t=>this.showError(t))):this._params.post?this._request.post(this._params.post,e).then(this._submitResponseHandler).catch((t=>this.showError(t))):void 0};_submitResponseHandler=t=>{t.json().then((e=>{if(!t.ok)return this.showError(e.error);this.trigger("stored",e)}))};showError=t=>{const e=t instanceof Error?t.message:t;return this._errorDisplay.clear().add(e),this};_prefill=t=>{t.json().then((e=>{if(!t.ok)return this.showError(e.error);this.values(e)}))};values=t=>{if(void 0===t){const t={};for(const[e,i]of Object.entries(this._inputs))t[e]=i.value();for(const[e,i]of Object.entries(this._fieldsets))Object.assign(t,i.values());return t}for(const[e,i]of Object.entries(t)){const t=this._inputs[e];t&&t.value(i)}for(const e of Object.values(this._fieldsets))e.values(t);return this};remove(){if(this._title&&this._title.remove(),this._inputs)for(const t of Object.values(this._inputs))t.remove();if(this._fieldsets)for(const t of Object.values(this._fieldsets))t.remove();if(this._buttons)for(const t of Object.values(this._buttons))t.remove();this._request&&this._request.remove(),this._title=null,this._inputs={},this._fieldsets={},this._buttons={},super.remove()}}class g extends i{_container=null;_form=null;constructor(t,e={}){super(),this._container=document.createElement("div"),this._container.classList.add("login","component");const i="Login";this.pageTitle(i),this._form=new b(this._container,{title:i,center:!0,params:{post:"/login"},inputs:[{name:"email",options:{label:"Email address",type:"email",required:!0}},{name:"password",options:{label:"Password",type:"password",required:!0}}],buttons:[{name:"submit",options:{label:"Login",type:"submit"}}]}),this._form.on("stored",(t=>{s("/admin/apps")})),this.addLink("Log in with an email link.","/login/link"),this.addLink("Register a new account.","/register"),t.appendChild(this._container)}addLink(t,e){const i=document.createElement("a");i.addEventListener("click",(()=>{s(e)})),i.textContent=t;const n=document.createElement("p");n.appendChild(i),this._container.appendChild(n)}remove(){this._form.remove(),super.remove()}}class w extends i{_container=null;_form=null;constructor(t,e={}){super(),this._container=document.createElement("div"),this._container.classList.add("login","component");const i="Login";this.pageTitle(i),this._form=new b(this._container,{title:i,center:!0,params:{post:"/login/sendLink"},inputs:[{name:"email",options:{label:"Email address",type:"email",required:!0}}],buttons:[{name:"submit",options:{label:"Send login link",type:"submit"}}]}),this._form.on("stored",(t=>{this.clear(),this._apology=new h(this._container,{title:"Click the link in your inbox to log in.",link:{text:"Retry.",location:()=>{this.trigger("clearCache",[w]),s("/login/link")}}})})),this.addLink("Log in with a password.",(()=>{s("/login")})),this.addLink("Register a new account.",(()=>{s("/register")})),t.appendChild(this._container)}addLink(t,e){const i=document.createElement("a");i.addEventListener("click",e),i.textContent=t;const s=document.createElement("p");s.appendChild(i),this._container.appendChild(s)}clear(){for(this._form&&this._form.remove(),this._apology&&this._apology.remove();this._container.firstChild;)this._container.firstChild.remove();return this}remove(){this.clear(),super.remove()}}class y extends i{_container=null;_form=null;constructor(t,e={}){super(),this._container=document.createElement("div"),this._container.classList.add("registration","component");const i="Registration";this.pageTitle(i),this._form=new b(this._container,{title:i,center:!0,params:{post:"/user"},inputs:[{name:"email",options:{label:"Email address",type:"email",required:!0}},{name:"password",options:{label:"Password",type:"password",required:!0}},{name:"repeat",options:{label:"Repeat password",type:"password",required:!0}}],buttons:[{name:"submit",options:{label:"Register",type:"submit"}}]}),this._form.on("stored",(()=>{this.clear(),this._apology=new h(this._container,{title:"Click the link in your inbox to verify your account.",link:{text:"Register a new account.",location:()=>{this.trigger("clearCache",[y]),s("/register")}}})})),this.addLink("Log in with a password.",(()=>{s("/login")})),this.addLink("Log in with an email link.",(()=>{s("/login/link")})),t.appendChild(this._container)}addLink(t,e){const i=document.createElement("a");i.addEventListener("click",e),i.textContent=t;const s=document.createElement("p");s.appendChild(i),this._container.appendChild(s)}clear(){for(this._form&&this._form.remove(),this._apology&&this._apology.remove();this._container.firstChild;)this._container.firstChild.remove();return this}remove(){this.clear(),super.remove()}}class C extends i{_top=null;_bottom=null;constructor(t){super(),this._container=document.createElement("div"),this._container.classList.add("overlay"),this._top=document.createElement("section"),this._top.classList.add("overlay-top"),this._container.appendChild(this._top),this._bottom=document.createElement("section"),this._bottom.classList.add("overlay-bottom"),this._container.appendChild(this._bottom),t.appendChild(this._container)}add=(t,e={})=>{const i=document.createElement(t);return e.text&&(i.textContent=e.text),e.animated&&i.classList.add("animated"),"top"==e.location?this._top.appendChild(i):this._bottom.appendChild(i),i};remove(){this._top.remove(),this._bottom.remove(),super.remove()}}class x extends i{_overlay=null;_state=null;constructor(t){super();const e=this._initInterface(t);this._state={inputStream:{type:"LiveStream",constraints:{width:{min:1280},height:{min:720},facingMode:"environment",aspectRatio:{min:1,max:2}},target:e},numOfWorkers:0,frequency:10,decoder:{readers:[{format:"ean_reader",config:{}},{format:"ean_8_reader",config:{}},{format:"upc_reader",config:{}},{format:"upc_e_reader",config:{}},{format:"code_93_reader",config:{}}],multiple:!1},locate:!0,locator:{patchSize:"medium",halfSample:!0}},this._initQuagga()}_initQuagga=()=>{this.start(),Quagga.onDetected((t=>{const e=t.codeResult.code;this.trigger("scanned",{code:e})}))};_initInterface=t=>{this._container=document.createElement("div"),this._container.classList.add("barcodescanner");const e=document.createElement("div");return e.classList.add("barcodescanner-video"),this._container.appendChild(e),this._initOverlay(this._container),t.appendChild(this._container),e};_initOverlay=t=>{const e=document.createElement("div");e.classList.add("barcodescanner-overlay"),this._overlay=new C(e),t.appendChild(e)};_handleError=t=>{this.trigger("error",t)};overlay=()=>this._overlay;start=(t=this._state)=>(Quagga.init(t,(t=>{if(t)return this._handleError(t);Quagga.start()})),this);stop=()=>(Quagga.stop(),this);remove(){this.stop(),delete this._state,this._overlay.remove(),super.remove()}}class E{_renderer=null;_hitTestSource=null;_session=null;_options=null;constructor(t,e){this._renderer=t,this._options=e,this._renderer.xr.addEventListener("sessionend",(()=>this._resetHitTestSource())),this._renderer.xr.addEventListener("sessionstart",(()=>this._onSessionStart())),this._renderer.xr.isPresenting&&this._onSessionStart()}_resetHitTestSource=()=>{this._hitTestSource=null};_onSessionStart=async()=>(this._session=this._renderer.xr.getSession(),this._options.space?this._hitTestSource=await this._session.requestHitTestSource(this._options):this._options.profile?this._hitTestSource=await this._session.requestHitTestSourceForTransientInput(this._options):void 0);doHit=t=>{if(!this._renderer.xr.isPresenting)return;const e=this._renderer.xr.getReferenceSpace();return this._hitTestSource&&t.getViewerPose(e)?this._options.profile?this._transientHitTest(t,e):this._hitTest(t,e):void 0};_hitTest=(t,e)=>{const i=t.getHitTestResults(this._hitTestSource);if(!i.length)return!1;return{pose:i[0].getPose(e),inputSpace:this._options.space}};_transientHitTest=(t,e)=>{const i=t.getHitTestResultsForTransientInput(this._hitTestSource);if(!i.length)return!1;const s=i[0];if(!s.length)return!1;return{pose:s[0].getPose(e),inputSpace:i[0].inputSource.targetRaySpace}};remove=()=>{}}class L extends i{_container=null;_cache=new Map;_latestSuccess=!1;constructor(t){super(),this._registerPrimitive("ar-hit-test"),this._container=document.createElement("a-reticle"),this._container.classList.add("arscene-reticle"),this._container.setAttribute("testing","false"),this._container.setAttribute("visible","false"),this._container.setAttribute("position","0 0 0"),this._container.setAttribute("rotation","0 0 0");const e=document.createElement("a-plane");e.setAttribute("rotation","-90 0 0"),e.setAttribute("width","0.2"),e.setAttribute("height","0.2"),e.setAttribute("src","/images/arrowTransparent.png"),e.setAttribute("material","transparent:true;"),this._container.appendChild(e),t.appendChild(this._container)}_registerPrimitive=t=>{this._registerComponent(t),AFRAME.primitives.primitives["a-reticle"]||AFRAME.registerPrimitive("a-reticle",{defaultComponents:{"ar-hit-test":{},rotation:{x:-90,y:0,z:0}},mappings:{target:t+".target",testing:t+".doHitTest"}})};_registerComponent=t=>{const i=this;AFRAME.components[t]||AFRAME.registerComponent(t,{schema:{target:{type:"selector"},doHitTest:{type:"boolean",default:!0}},init:function(){this.hitTest=null,this.hasFoundAPose=!1,this.onSessionEnd=()=>{this.hitTest=null,this.hasFoundAPose=!1},this.onSessionStart=async()=>{const t=this.el.sceneEl.renderer,e=this.session=t.xr.getSession(),i=await e.requestReferenceSpace("viewer"),s=new E(t,{space:i});this.hitTest=s},this.el.sceneEl.renderer.xr.addEventListener("sessionstart",this.onSessionStart),this.el.sceneEl.renderer.xr.addEventListener("sessionend",this.onSessionEnd)},tick:function(t,s){if(!this.data.doHitTest)return;const n=this.el.sceneEl.frame;if(!n)return;if(!this.hitTest)return;const o=this.hitTest.doHit(n);if(!o)return this.el.setAttribute("visible",!1),void i._success(!1);const{pose:r,inputSpace:a}=o;try{this.currentControllerPose=n.getPose(a,this.el.sceneEl.renderer.xr.getReferenceSpace())}catch(t){console.error(e)}this.hasFoundAPose=!0,this.el.setAttribute("visible",!0),this.el.setAttribute("position",r.transform.position),this.el.object3D.quaternion.copy(r.transform.orientation),i._success(!0)},remove:function(){this.el.sceneEl.renderer.xr.removeEventListener("sessionstart",this.onSessionStart),this.el.sceneEl.renderer.xr.removeEventListener("sessionend",this.onSessionEnd)}})};_success=t=>{this._latestSuccess!=t&&(this._latestSuccess=t,t?this.trigger("success"):this.trigger("fail"))};position=()=>this._container.getAttribute("position");rotation=()=>this._container.getAttribute("rotation");show(){return this._success(!1),this._container.setAttribute("testing",!0),this}hide(){return this._container.setAttribute("visible",!1),this._container.setAttribute("testing",!1),this}remove(){this._cache.clear(),super.remove()}}class T extends i{_request=null;_container=null;_models=[];_position=null;_rotation=null;_dimensions=null;constructor(t,...e){super(),this._container=document.createElement("a-entity"),this._container.classList.add("ar-model"),this._request=new c,e.length&&this.update(...e),t.appendChild(this._container)}update=async(t,e=1,i=1)=>{this.hide();const s=this._request.model(t);this.clear();const n=[];for(let t=0;t<e;t++)n.push(this._addModel(s,i));return Promise.all(n).then((()=>{this._dimensions=this._modelDimensions(),this.position().show()}))};position=(t,e)=>{if(t?this._position=t:t=this._position,e?this._rotation=e:e=this._rotation,!t||!e)return this;const i=this._models.length,s=Math.ceil(Math.pow(i,1/3)),n=s**2,o=this._dimensions,r=t.clone().setX(t.x-o.xOffset-s*o.width/2).setY(t.y-o.yOffset).setZ(t.z-o.zOffset-s*o.depth/2),a=r.clone();for(let t=0;t<this._models.length;t++){const i=t%s,l=~~(t/n),h=~~(t/s)%s;a.setX(r.x+i*o.width).setY(r.y+l*o.height).setZ(r.z+h*o.depth);const c=this._models[t];c.setAttribute("position",a),c.setAttribute("rotation",e)}return this};_modelDimensions=()=>{const t=this._models[0];if(t){const e=new AFRAME.THREE.Box3;return e.setFromObject(t.object3D),{width:e.max.x-e.min.x,height:e.max.y-e.min.y,depth:e.max.z-e.min.z,xOffset:e.min.x,yOffset:e.min.y,zOffset:e.min.z}}return{width:1,height:1,depth:1,xOffset:0,yOffset:0,zOffset:0}};_addModel=async(t,e)=>new Promise(((i,s)=>{const n=document.createElement("a-gltf-model");n.classList.add("arscene-object"),n.setAttribute("visible","true"),n.object3D.scale.set(e,e,e),this._container.appendChild(n),this._models.push(n),n.addEventListener("model-loaded",i),n.setAttribute("src",t)}));_removeModel=()=>{this._models.pop().remove()};clear=()=>{for(;this._models.length;)this._removeModel();return this};show(){super.show();for(const t of this._models)t.setAttribute("visible","true");return this}hide(){super.hide();for(const t of this._models)t.setAttribute("visible","false");return this}remove(){this._request&&this._request.remove();for(const t of this._models)t.remove();this._models=[],super.remove()}}const S=(t,e)=>{let i;return function(){const s=this,n=arguments,o=()=>{i=null,t.apply(s,n)};clearTimeout(i),i=setTimeout(o,e)}};class k{_targets=new Map;_observer=null;constructor(){this._observer=new MutationObserver((t=>{for(const e of t){if("attributes"!=e.type)return;this._targets.has(e.target)&&this._targets.get(e.target)(e)}}))}on(t,e){if(!(!t instanceof Element))return this._targets.set(t,e),this._observer.observe(t,{attributes:!0}),this}remove(){this._observer&&(this._observer.disconnect(),this._observer=null,this._targets.clear())}}class A extends i{_mode="inactive";_scene=null;_reticle=null;_model=null;_assets=null;_overlay=null;_overlayContainer=null;_interface=null;_proceedButton=null;_stopButton=null;_instructions=null;_overlayTitle;_texts=null;_observer=null;_product=null;_modelIndex=-1;constructor(t,e){super(),this._texts=e,this._initInterface(t)}_initInterface=t=>{this._container=document.createElement("div"),this._container.classList.add("arscene"),this._createOverlay(this._container),this._createScene(this._container),this.hide(),t.appendChild(this._container)};_createScene=t=>{this._scene=document.createElement("a-scene"),this._scene.classList.add("arscene-scene"),this._scene.setAttribute("visible","false"),this._scene.setAttribute("vr-mode-ui","enabled: false"),this._scene.setAttribute("webxr","optionalFeatures: hit-test, local-floor, dom-overlay; overlayElement: .arscene-overlay;"),this._reticle=new L(this._scene),this._startReticleSync(),this._addOverlayToScene(this._scene),this._model=new T(this._scene).hide(),t.prepend(this._scene),this._preventClass("html","a-fullscreen"),this._scene.renderStarted?this._initScene():this._scene.addEventListener("loaded",(()=>{this._initScene()}))};_preventClass=(t,e)=>{const i=document.getElementsByTagName(t)[0];this._observer=new k,this._observer.on(i,(t=>{"class"==t.attributeName&&i.classList.contains(e)&&(i.classList.remove(e),this._observer.remove())}))};_initScene=()=>{this._scene.addEventListener("exit-vr",(()=>{this.stop()})),this._scene.addEventListener("enter-vr",(()=>{this._activateScene()})),this.trigger("loaded")};_activateScene=()=>{if(this._scene.is("vr-mode"))return this._handleError("VR mode is not yet implemented.");if(!this._scene.is("ar-mode"))return this._handleError("Could not enter augmented reality mode.");const t=!(!this._scene.xrSession.domOverlayState||!this._scene.xrSession.domOverlayState.type);this._overlayContainer.setAttribute("text","value","Overlay: "+t),this._overlayContainer.setAttribute("visible","true"),this._scene.setAttribute("visible","true"),this._placeModel()};_handleError=t=>{this.trigger("error",t)};_addOverlayToScene=t=>{const e=document.createElement("a-camera");this._interface=document.createElement("a-entity"),this._interface.classList.add("arscene-interface"),this._interface.setAttribute("text","align: left; width: 0.1;"),this._interface.setAttribute("position","0 0 -0.25;"),this._interface.setAttribute("visible","false"),e.appendChild(this._interface),t.appendChild(e)};_createOverlay=t=>{this._overlayContainer=document.createElement("div"),this._overlayContainer.classList.add("arscene-overlay"),this._overlay=new C(this._overlayContainer),this._overlayTitle=this._overlay.add("h1",{location:"top"}),this._instructions=this._overlay.add("p",{location:"top"}),this._proceedButton=this._overlay.add("button"),this._allowProceed(),this._stopButton=this._overlay.add("button",{text:this._texts["exit-button"]||"Exit"});const e=S((()=>{this._scene.xrSession.end()}),500);this._stopButton.addEventListener("mousedown",e),this._stopButton.addEventListener("touchstart",e),t.appendChild(this._overlayContainer)};_placeModel=()=>{this._startReticleSync(),this._modelIndex=-1,this._reticle.show(),this._model.hide(),this._overlayTitle.textContent=this._texts["placing-title"]||"",this._instructions.textContent=this._texts["placing-description"]||"",this._proceedButton.textContent=this._texts["placing-button"]||"Place"};_showModel=()=>{this._stopReticleSync();const t=this._product.models[this._modelIndex];this._model.update(t._id,t.multiplier,t.scale).then((()=>{0==this._modelIndex&&(this._reticle.hide(),this._model.position(this._reticle.position(),this._reticle.rotation()).show())})),this._overlayTitle.textContent=t["viewing-title"]||"",this._instructions.textContent=t["viewing-description"]||"",this._proceedButton.textContent=t["viewing-button"]||"Proceed"};active=()=>this._scene.renderStarted;proceed=()=>(this._modelIndex+=1,this._modelIndex<this._product.models.length?this._showModel():this._placeModel(),this);_proceedHandler=S((()=>{this.proceed()}),500);_startReticleSync=()=>{this._preventProceed(),this._reticle.on("success",this._allowProceed).on("fail",this._preventProceed)};_stopReticleSync=()=>{this._reticle.off("success",this._allowProceed).off("fail",this._preventProceed),this._allowProceed()};_preventProceed=()=>{this._proceedButton.removeEventListener("mousedown",this._proceedHandler),this._proceedButton.removeEventListener("touchstart",this._proceedHandler),this._proceedButton.disabled=!0};_allowProceed=()=>{this._proceedButton.addEventListener("mousedown",this._proceedHandler),this._proceedButton.addEventListener("touchstart",this._proceedHandler),this._proceedButton.disabled=!1};select=t=>{this._product=t;try{this._scene.enterAR(),this.show()}catch(t){this._handleError(t)}return this};stop=()=>(this._reticle.hide(),this.trigger("end"),this);_stopHandler=S((()=>{this.stop()}),500);show(){return this._reticle.show(),super.show(),this}hide(){return this._reticle.hide(),super.hide(),this}remove(){this.stop(),this._overlay&&this._overlay.remove(),this._reticle&&this._reticle.remove(),this._observer&&this._observer.remove(),this._scene&&this._scene.remove(),this._model&&this._model.remove(),this._assets&&this._assets.remove(),this._overlayContainer&&this._overlayContainer.remove(),this._interface&&this._interface.remove(),this._proceedButton&&this._proceedButton.remove(),this._stopButton&&this._stopButton.remove(),this._instructions&&this._instructions.remove(),super.remove()}}class q extends t{_toLoad=[];_loading=new Map;_loaded=new Map;_failed=new Map;_head=null;constructor(t){super(),this._head=document.getElementsByTagName("head")[0],t&&this.loadAll(t)}_loadHandler=t=>{const e=t.target,i=e.slug;this._loading.delete(i),this._loaded.set(i,e),this.trigger("loaded",{path:i,element:e}),this._toLoad.length||this._loading.size||this._failed.size||this.trigger("loaded-all")};_errorHandler=t=>{const e=t.target,i=e.slug;this._loading.delete(i),this._failed.set(i,e),this.trigger("failed",{path:i,tag:e})};_alreadyLoaded=t=>document.querySelector(`script[src*="${t}"]`);loadAll=t=>{this._toLoad=t;for(const e of t)this.load(e);return this};load=t=>{if(this._loading.has(t)||this._loaded.has(t))return;this._failed.has(t)&&this._failed.delete(t);const e=this._alreadyLoaded(t);if(e)return this._toLoad=this._toLoad.filter((e=>t!=e)),this._loadHandler({target:e}),this;const i=document.createElement("script");return i.type="text/javascript",i.onerror=this._errorHandler,i.onload=this._loadHandler,this._toLoad=this._toLoad.filter((e=>t!=e)),this._loading.set(t,i),this._head.appendChild(i),i.src=t,i.slug=t,this};remove(){this._toLoad=[],this._head=null,this._loaded.clear(),this._loading.clear(),this._failed.clear(),super.remove()}}class P extends i{_request=null;_scene=null;_scanner=null;_scriptLoader=null;_products={};_productsPromise=null;_shownProduct=null;_productDisplay=null;_selectButton=null;_texts=null;_textsPromise=null;constructor(t,e={}){super();this._scriptLoader=new q,this._request=new c,this._loadProducts(e.appPath),this._loadTexts(e.appPath),this._scriptLoader.on("loaded-all",(t=>{this._textsPromise.then((t=>{if(t)return t.json().then((t=>{this._texts=t,this._enableFullscreen(),this._loadBarcodeScanner(),this._loadArScene(),this._getProductFromUrl()}))}))})),this._scriptLoader.loadAll(["/quagga/quagga.min.js","/aframe/aframe.min.js"]),this._container=document.createElement("div"),this._container.classList.add("representation"),t.appendChild(this._container)}_getProductFromUrl=()=>{const t=new URL(window.location.href).searchParams.get("product");this._productsPromise.then((()=>{this._processBarcode({code:t})}))};_enableFullscreen=()=>{document.getElementsByTagName("html")[0].classList.add("fullscreen")};_disableFullscreen=()=>{document.getElementsByTagName("html")[0].classList.remove("fullscreen")};_loadArScene=()=>{this._scene=new A(this._container,this._texts),this._scene.on("error",(t=>{this.trigger("error",t)})),this._scene.on("end",this._onSceneEnd);const t=S(this._selectProduct,500);this._scene.on("loaded",(()=>{this._selectButton.addEventListener("click",t),this._selectButton.addEventListener("touchend",t),this._shownProduct&&(this._selectButton.disabled=!1)}))};_onSceneEnd=()=>{this._scene.hide(),this._scanner.start().show()};_loadBarcodeScanner=()=>{this._scanner=new x(this._container),this._scanner.on("error",(()=>{this.trigger("error","Error: could not access camera")})),this._scanner.on("scanned",this._processBarcode);const t=this._scanner.overlay();this.pageTitle(this._texts.name),t.add("h1",{text:this._texts["scanning-title"],location:"top"}),t.add("p",{text:this._texts["scanning-description"],location:"top"}),this._productDisplay=t.add("p",{animated:!0}),this._selectButton=t.add("button",{text:this._texts["scanning-button"]||"Select"}),this._selectButton.disabled=!0};_selectProduct=t=>{this._scanner.stop().hide(),this._scene.select(this._shownProduct)};_processBarcode=t=>{t.code in this._products&&(this._shownProduct&&t.code==this._shownProduct.barcode||(this._shownProduct=this._products[t.code],this._productDisplay.textContent="",setTimeout((()=>{this._productDisplay.textContent=this._shownProduct.name}),200),this._scene.active()&&(this._selectButton.disabled=!1)))};_loadProducts=t=>{this._productsPromise=this._request.get("/app/"+t+"/products").catch((t=>{this.trigger("error",t)})).then((t=>{if(t)return t.json().then((t=>{for(const e of t)this._products[e.barcode]=e}))}))};_loadTexts=t=>{this._textsPromise=this._request.get("/app/"+t).catch((t=>{this.trigger("error",t)}))};show(){return this._enableFullscreen(),super.show(),this}hide(){return this._disableFullscreen(),super.hide(),this}remove(){this.hide(),this._scene&&this._scene.off("end",this._onSceneEnd),this._scanner&&this._scanner.remove(),this._scene&&this._scene.remove(),this._request&&this._request.remove(),this._scriptLoader&&this._scriptLoader.remove(),this._productDisplay&&this._productDisplay.remove(),this._selectButton&&this._selectButton.remove(),this._productsPromise&&this._productsPromise.then((()=>{delete this._products,this._productsPromise=null})),this._shownProduct&&delete this._shownProduct,super.remove()}}class O extends i{_message=null;_buttonContainer=null;_buttons=[];constructor(t={}){if(super(),this._container=document.createElement("div"),this._container.classList.add("confirmation"),this._message=document.createElement("div"),this._message.classList.add("message"),this._container.appendChild(this._message),t.title){const e=document.createElement("h1");e.textContent=t.title,this._message.appendChild(e)}if(t.description){const e=document.createElement("p");e.textContent=t.description,this._message.appendChild(e)}document.body.appendChild(this._container)}addButton=t=>{this._buttonContainer||(this._buttonContainer=document.createElement("div"),this._buttonContainer.classList.add("buttons"),this._message.appendChild(this._buttonContainer));const e=new u(this._buttonContainer,t);return this._buttons.push(e),e};remove(){if(this._buttons)for(const t of this._buttons)t.remove();this._message&&this._message.remove(),this._buttonContainer&&this._buttonContainer.remove(),this._buttons=[],super.remove()}}class B extends i{_title=null;_description=null;_buttonContainer=null;_buttons=[];constructor(t,e={}){if(super(),this._container=document.createElement("div"),this._container.classList.add("card"),this.title(e.title),this.description(e.description),e.viewable&&this.addButton({label:"View",type:"default"}).on("click",(()=>{this.trigger("view",e.id)})),e.editable&&this.addButton({label:"Edit",type:"default"}).on("click",(()=>{this.trigger("edit",e.id)})),e.removable&&this.addButton({label:"Remove",type:"remove"}).on("click",(()=>{this._removeHandler(e.id)})),e.buttons)for(const t of e.buttons)this.addButton(t);t.appendChild(this._container)}_removeHandler=t=>{const e=new O({title:"Are you sure you want to remove this item?",description:"You are about to permanently remove this item. This action is irreversible."});e.addButton({label:"Yes",type:"confirm"}).on("click",(()=>{e.remove(),this.trigger("remove",t)})),e.addButton({label:"No",type:"cancel"}).on("click",(()=>{e.remove()}))};title=t=>(this._title||(this._title=new v(this._container,{type:"h2"})),t&&this._title.update(t),this);description=t=>(this._description||(this._description=document.createElement("p"),this._container.appendChild(this._description)),t&&(this._description.textContent=t),this);addButton=t=>{this._buttonContainer||(this._buttonContainer=document.createElement("div"),this._buttonContainer.classList.add("buttons"),this._container.appendChild(this._buttonContainer));const e=new u(this._buttonContainer,t);return this._buttons.push(e),e};remove(){if(this._title&&this._title.remove(),this._buttons)for(const t of this._buttons)t.remove();this._description&&this._description.remove(),this._buttonContainer&&this._buttonContainer.remove(),this._buttons=[],super.remove()}}class j extends i{_titleContainer=null;_errorContainer=null;_buttonContainer=null;_cardContainer=null;_title=null;_errorDisplay=null;_cards=[];_buttons=[];constructor(t,e={}){if(super(),this._container=document.createElement("div"),this._container.classList.add("overview"),this._titleContainer=document.createElement("div"),this._titleContainer.classList.add("title"),this._errorContainer=document.createElement("div"),this._errorContainer.classList.add("errors"),this._buttonContainer=document.createElement("div"),this._buttonContainer.classList.add("buttons"),this._cardContainer=document.createElement("div"),this._cardContainer.classList.add("cards"),this._container.appendChild(this._titleContainer),this._container.appendChild(this._errorContainer),this._container.appendChild(this._buttonContainer),this._container.appendChild(this._cardContainer),e.title&&this.title(e.title),this._errorDisplay=new f(this._errorContainer),e.center&&this._container.classList.add("center"),e.buttons)for(const t of e.buttons)this.addButton(t);if(e.cards)for(const t of e.cards)this.addCard(t);t.appendChild(this._container)}title=t=>(this._title?t?this._title.update(t):this._title.remove():t&&(this._title=new v(this._titleContainer,{title:t})),document.getElementsByTagName("title")[0].textContent=t,this);addCard=(t={})=>{const e=new B(this._cardContainer,t);return this._cards.push(e),e.bubbleTo(this),e};addButton=(t={})=>{const e=new u(this._buttonContainer,t);return t.callback&&e.on("click",t.callback),this._buttons.push(e),e.bubbleTo(this),e};showError=t=>{const e=t instanceof Error?t.message:t;return this._errorDisplay.clear().add(e),this};remove(){if(this._title&&this._title.remove(),this._cards.length)for(const t of this._cards)t.remove();if(this._buttons.length)for(const t of this._buttons)t.remove();this._title=null,this._cards=[],this._buttons=[],this._titleContainer&&this._titleContainer.remove(),this._errorContainer&&this._errorContainer.remove(),this._buttonContainer&&this._buttonContainer.remove(),this._cardContainer&&this._cardContainer.remove(),super.remove()}}class R extends i{_container=null;_overview=null;_request=null;_requestPromise=null;_addButton=null;constructor(t){super(),this._container=document.createElement("div"),this._container.classList.add("productlist","component"),this._request=new c;const e="Product overview";this.pageTitle(e),this._overview=new j(this._container,{title:e,center:!0,buttons:[{label:"Add product",callback:()=>{s("/admin/product/new")}}]}),this._requestPromise=this._request.get("/products").catch((t=>{this._overview.showError(t)})).then((t=>{if(t)return t.json().then((e=>{if(!t.ok)return this._overview.showError(e.error);const i={};for(const t of e){const e=this._overview.addCard({id:t._id,title:t.name,description:t.description,removable:!0,editable:!0,viewable:!1});i[t._id]=e}this._overview.on("remove",(t=>{this._request.delete("/product/"+t).catch((t=>{this._overview.showError(t)})).then((e=>{e.ok&&i[t].remove()}))})),this._overview.on("edit",(t=>{s("/admin/product/"+t)}))}))})),t.appendChild(this._container)}remove(){this._requestPromise&&this._requestPromise.then((()=>{this._overview.remove()})),super.remove()}}class I extends i{_container=null;_form=null;_modelsSelect=null;_productsSelect=null;_request=null;_modelsRequest=null;_appsRequest=null;constructor(t,e={}){super(),this._container=document.createElement("div"),this._container.classList.add("productform","component"),this._request=new c,this._createForm(e),t.appendChild(this._container),this._modelsRequest=this._request.get("/models").catch((t=>{this._form.showError(t)})).then((t=>{t&&t.json().then((e=>{if(!t.ok)return this._form.showError(e.error);for(const t of e)this._modelsSelect.addOption(t._id,t.name)}))})),this._appsRequest=this._request.get("/apps").catch((t=>{this._form.showError(t)})).then((t=>{t&&t.json().then((e=>{if(!t.ok)return this._form.showError(e.error);for(const t of e)this._appsSelect.addOption(t._id,t.name)}))}))}_createForm=t=>{const e=t.productId?{put:"/product/"+t.productId,get:"/product/"+t.productId}:{post:"/product"},i=t.productId?"Product configuration":"Product creation";this.pageTitle(i),this._form=new b(this._container,{title:i,center:!0,params:e,inputs:[{name:"name",options:{label:"Name",type:"text",tooltip:"Give your product a name. This name is also visible to users who scan this product.",required:!0}},{name:"barcode",options:{label:"Barcode",type:"number",tooltip:"Enter the product's barcode. It is important that this is entered accurately, or the user won't be able to scan the product!",required:!0}}]}),this._modelsSelect=this._form.addInput("models",{label:"Models",placeholder:"Select model ...",tooltip:"Select the models to display for this product. You can select multiple models per product. They will appear to the user in the order that is displayed here; the first model you add will be the first model the user sees.",type:"multiselect"}),this._appsSelect=this._form.addInput("app",{placeholder:"Select app ..",tooltip:"Select the app to which to add this product. You cannot add more than one product to an app with the same barcode.",type:"select"}),this._form.addButton("submit",{label:t.productId?"Edit product":"Create product",type:"submit"}),this._form.on("stored",(()=>{this.trigger("clearCache",[I,R]),s("/admin/products")}))};remove(){Promise.all([this._modelsRequest,this._appsRequest]).then((()=>{this._form.remove()})),super.remove()}}class F extends i{_container=null;_overview=null;_request=null;_requestPromise=null;constructor(t){super(),this._container=document.createElement("div"),this._container.classList.add("applist","component"),this._request=new c;const e="App overview";this.pageTitle(e),this._overview=new j(this._container,{title:e,center:!0,buttons:[{label:"Add app",callback:()=>{s("/admin/app/new")}}]}),this._requestPromise=this._request.get("/apps").catch((t=>{this._overview.showError(t)})).then((t=>{if(t)return t.json().then((e=>{if(!t.ok)return this._overview.showError(e.error);const i={},n={};for(const t of e){const e=this._overview.addCard({id:t._id,title:t.name,description:t.description,removable:!0,editable:!0,viewable:!0});i[t._id]=e,n[t._id]=t.path}this._overview.on("remove",(t=>{this._request.delete("/app/"+t).catch((t=>{this._overview.showError(t)})).then((e=>{e.ok&&(i[t].remove(),this.trigger("clearCache",[I]))}))})),this._overview.on("edit",(t=>{s("/admin/app/"+t)})),this._overview.on("view",(t=>{s("/app/"+n[t])}))}))})),t.appendChild(this._container)}remove(){this._requestPromise&&this._requestPromise.then((()=>{this._overview.remove()})),super.remove()}}class D extends i{_container=null;_form=null;constructor(t,e={}){super();const i=e.appId?{put:"/app/"+e.appId,get:"/app/"+e.appId}:{post:"/app"};this._container=document.createElement("div"),this._container.classList.add("appform","component");const n=e.appId?"App configuration":"App creation";this.pageTitle(n),this._form=new b(this._container,{title:n,center:!0,params:i,inputs:[{name:"name",options:{label:"Name",type:"text",tooltip:"Give your app a name. This name is also visible to users in the browser tab.",required:!0}},{name:"description",options:{label:"Description",type:"textarea",tooltip:"Give your app a description. This description is only visible to you."}},{name:"path",options:{label:"Path",type:"text",tooltip:"Give your app a path. This is the last part of the URL where the app will appear. It has to be unique.",required:!0}},{name:"exit-button",options:{label:"Exit button",type:"text",tooltip:"In the augmented reality scene, an app always has a button that allows the user to exit the scene. Here you can decide the text for this button.",required:!0}}],fieldsets:[{name:"scanning",options:{legend:"Texts in scanning mode",tooltip:"These are the texts that will appear when a user is scanning a product.",inputs:[{name:"title",options:{label:"Title",type:"text",tooltip:"This is the title that will appear when a user is scanning a product."}},{name:"description",options:{label:"Description",type:"textarea",tooltip:"This is the description that will appear when a user is scanning a product. This is the perfect place to give the user hints for how to scan a product."}},{name:"button",options:{label:"Button",type:"text",tooltip:"This is the text for the button that the user uses to select a product that they have scanned. By clicking this button, the user enters the augmented reality scene.",required:!0}}]}},{name:"placing",options:{legend:"Texts in placing mode",tooltip:"These are the texts that will appear when a user is detecting surfaces on which to place the 3D models.",inputs:[{name:"title",options:{label:"Title",type:"text",tooltip:"This is the title that will appear when a user is detecting surfaces on which to place the 3D models."}},{name:"description",options:{label:"Description",type:"textarea",tooltip:"This is the description that will appear when a user is detecting surfaces on which to place the 3D models. This is the perfect place to give the user hints for how to detect a surface."}},{name:"button",options:{label:"Button",type:"text",tooltip:"This is the text for the button that the user uses to select a surface that they have detected. By clicking this button, the user places the first 3D model.",required:!0}}]}}],buttons:[{name:"submit",options:{label:e.appId?"Edit app":"Create app",type:"submit"}}]}),this._form.on("stored",(()=>{this.trigger("clearCache",[D,F,I]),s("/admin/apps")})),t.appendChild(this._container)}remove(){this._form.remove(),super.remove()}}class M extends i{_container=null;_overview=null;_request=null;_requestPromise=null;_addButton=null;constructor(t){super(),this._container=document.createElement("div"),this._container.classList.add("modellist","component"),this._request=new c;const e="Model overview";this.pageTitle(e),this._overview=new j(this._container,{title:e,center:!0,buttons:[{label:"Add model",callback:()=>{s("/admin/model/new")}}]}),this._requestPromise=this._request.get("/models").catch((t=>{this._overview.showError(t)})).then((t=>{if(t)return t.json().then((e=>{if(!t.ok)return this._overview.showError(e.error);const i={};for(const t of e){const e=this._overview.addCard({id:t._id,title:t.name,description:t.description,removable:!0,editable:!0,viewable:!1});i[t._id]=e}this._overview.on("remove",(t=>{this._request.delete("/model/"+t).catch((t=>{this._overview.showError(t)})).then((e=>{e.ok&&(i[t].remove(),this.trigger("clearCache",[I]))}))})),this._overview.on("edit",(t=>{s("/admin/model/"+t)}))}))})),t.appendChild(this._container)}remove(){this._requestPromise&&this._requestPromise.then((()=>{this._overview.remove()})),super.remove()}}class H extends i{_container=null;_form=null;_request=null;_requestPromise=null;constructor(t,e={}){super(),this._container=document.createElement("div"),this._container.classList.add("modelform","component"),this._request=new c,this._createForm(e),t.appendChild(this._container)}_createForm=t=>{const e=t.modelId?{put:"/model/"+t.modelId,get:"/model/"+t.modelId}:{post:"/model"},i=t.modelId?"Model configuration":"Model creation";this.pageTitle(i),this._form=new b(this._container,{title:i,center:!0,params:e,inputs:[{name:"name",options:{label:"Name",type:"text",tooltip:"Give your model a name. This name is only visible to you.",required:!0}},{name:"model",options:{label:"Upload model ...",accept:".glTF,.zip,.glb",type:"file",tooltip:"Click this button to select the model to upload. This can be a single file with a .glTF or .glb extension, or a .zip directory that contains an FBX, OBJ, or GLTF model and its dependencies."}},{name:"multiplier",options:{label:"Multiplier",type:"number",tooltip:"You can set a multiplier of 1 or greater. If you select 2 or more, the app will display the 3D model multiple times and try to stack them in a cube-like fashion.",set:1}},{name:"scale",options:{label:"Scale",type:"number",tooltip:"You can set a scaling factor for the model here. If set to 1, the app will show the model at its native size. Any values greater than 1 will increase the model's size. Values between 0 and 1 will shrink the model, and values below 0 will turn the model upside down.",step:"any"}}],fieldsets:[{name:"viewing",options:{legend:"Texts in viewing mode",tooltip:"While this model is being displayed, you can also make texts appear on the page. Here you can determine those texts.",inputs:[{name:"title",options:{label:"Title",type:"text",tooltip:"Set the title to show while this model is being displayed."}},{name:"description",options:{label:"Description",type:"textarea",tooltip:"Set the description to show while this model is being displayed."}},{name:"button",options:{label:"Button",type:"text",tooltip:"Set the text for the button that the user can press to see the next model. If there is no next model, the button press will return the user to the surface detection mode.",required:!0}}]}}],buttons:[{name:"submit",options:{label:t.modelId?"Edit model":"Create model",type:"submit"}}]}),this._form.on("stored",(()=>{this.trigger("clearCache",[H,M,I]),s("/admin/models")}))};remove(){this._form.remove(),super.remove()}}const z=document.body;new class extends i{_pages=null;_locations=new Map;constructor(t,e={}){super(),this._container=document.createElement("div"),this._container.classList.add("menu");const i=document.createElement("nav");i.classList.add("navigation"),this._pages=e.pages,e.navigation&&this._addAnchors(i,e.navigation),window.addEventListener("popstate",this._processPathChange),this._processPathChange(),this._container.appendChild(i),t.prepend(this._container)}_processPathChange=t=>{const e=window.location.pathname;this._setCurrentSelection(e);for(const t of this._pages)if(e.startsWith(t))return this.show();return this.hide()};_setCurrentSelection=t=>{for(const[t,e]of this._locations.entries())e.classList.remove("current");this._locations.has(t)&&this._locations.get(t).classList.add("current")};_addAnchors=(t,e)=>{for(const[i,n]of e){const e=document.createElement("a");e.classList.add("button"),e.setAttribute("href",n),e.textContent=i,e.addEventListener("click",(t=>{t.preventDefault(),s(n)})),this._locations.set(n,e),t.append(e)}};remove(){window.removeEventListener("popstate",this._processPathChange),this._pages=null,this._locations.clear(),super.remove()}}(z,{pages:["/admin"],navigation:new Map([["Apps","/admin/apps"],["Products","/admin/products"],["Models","/admin/models"],["Profile","/admin/profile"],["Log out","/logout"]])});const N=new class extends i{_cacheSize=null;_widgets=new Map;constructor(t,e={}){super(),this._cacheSize=e.cacheSize>1?e.cacheSize:1,this._container=document.createElement("div"),this._container.classList.add("view"),e.Widget&&this.install(e.Widget,...e.params),t.appendChild(this._container)}install(t,...e){if(!this._widgets.has(t)){const i=this._activeWidget();i&&i.instance.hide();const s=new t(this._container,...e);s.on("clearCache",this._removeWidgets),s.bubbleTo(this),this._widgets.set(t,{instance:s,params:e}),this._widgets.size>this._cacheSize&&this._cullWidget()}return this._activate(t,e),this}_activeWidget(){return!!this._widgets.size&&Array.from(this._widgets).pop()[1]}_activate(t,e){if(!t)return;this._activeWidget().instance.hide();const i=this._widgets.get(t);this._widgets.delete(t),n(i.params,e)||(i.params=e,i.instance.remove(),i.instance=new t(this._container,...e)),this._widgets.set(t,i),i.instance.show()}_cullWidget(){const[t,e]=Array.from(this._widgets)[0];this._widgets.delete(t),e.instance.remove()}_removeWidgets=t=>{if(void 0===t)return this.clear();for(const e of t)this._removeWidget(e)};_removeWidget=t=>{if(!t)return;const e=this._widgets.get(t);e&&(this._widgets.delete(t),e.instance.remove())};clear(){for(const[t,e]of this._widgets)e.instance.remove();return this._widgets.clear(),this}remove(){this.clear(),super.remove()}}(z,{cacheSize:15,Widget:h,params:[{title:"Loading..."}]}).on("error",(t=>{N.install(h,{title:t})}));new class extends t{_routes=new Map;_protected=[];constructor(t=new Map,e={}){super();for(const e of t.keys())this.add(e,t.get(e));this._protected=e.protected,window.addEventListener("popstate",this.navigateToCurrent)}navigateToCurrent=()=>(this.navigateTo(window.location.pathname),this);_loggedIn=()=>!!l().xsrfToken;navigateTo=t=>{if(!this._loggedIn())for(const e of this._protected)if(t.startsWith(e))return this.trigger("not-allowed");for(const[e,i]of this._routes.entries()){const e=t.match(i.pattern);if(!e)continue;const s={};e.shift();for(let t=0;t<e.length;t++)s[i.variables[t]]=e[t];return this.trigger("navigate",{component:i.component,options:Object.assign({},i.options,s)})}return this.trigger("not-found")};add=(t,e,i)=>{const s=[];let n="^";for(const e of t.substring(1).split("/"))n+="/",e.startsWith(":")?(s.push(e.substring(1)),n+="([^/]+)"):n+=e;return n+="/?$",this._routes.set(t,{component:e,pattern:n,options:i,variables:s}),this};delete=t=>(this._routes.delete(t),this);clear=()=>(this._routes.clear(),this);remove(){window.removeEventListener("popstate",this.navigateToCurrent),super.remove()}}(new Map([["/app/:appPath",class extends i{_container=null;constructor(t,e={}){super(),this._container=document.createElement("div"),this._container.classList.add("app"),this._representation=new P(this._container,e),this._representation.on("error",(t=>{this.trigger("error",t)})),t.appendChild(this._container)}show(){return this._representation.show(),super.show(),this}hide(){return this._representation.hide(),super.hide(),this}remove(){this._representation.remove(),super.remove()}}],["/",g],["/login",g],["/login/link",w],["/invalid-link",class extends h{constructor(t){super(t,{title:"This link is invalid.",text:"Note that login links always expire in one hour.",link:{text:"Get a new link",location:"/login/link"}})}}],["/logout",class extends i{_container=null;_request=null;_apology=null;constructor(t){super(),this._container=document.createElement("div");const e="Logging out.";this.pageTitle(e),this._apology=new h(this._container,{title:e}),this._request=new c,this._request.get("/logout").catch((t=>{this._apology.update("Error occurred: could not log out.")})).then((t=>{if(!t)return this._apology.update("Error occurred: could not log out.");window.location.href="/login"})),t.appendChild(this._container)}remove(){this._form.remove(),super.remove()}}],["/register",y],["/admin",F],["/admin/apps",F],["/admin/app/new",D],["/admin/app/:appId",D],["/admin/models",M],["/admin/model/new",H],["/admin/model/:modelId",H],["/admin/products",R],["/admin/product/new",I],["/admin/product/:productId",I],["/admin/profile",class extends i{_container=null;_form=null;constructor(t){super(),this._container=document.createElement("div"),this._container.classList.add("passwordform","component");const e="Change password";this.pageTitle(e),this._form=new b(this._container,{title:e,center:!0,params:{post:"/user/password"},inputs:[{name:"password",options:{label:"Password",type:"password"}},{name:"repeat",options:{label:"Repeat password",type:"password"}}],buttons:[{name:"submit",options:{label:"Change",type:"submit"}}]}),this._form.on("stored",(()=>{s("/admin/apps")})),t.appendChild(this._container)}remove(){this._form.remove(),super.remove()}}]]),{protected:["/admin"]}).on("navigate",(t=>{N.install(t.component,t.options)})).on("not-found",(()=>{N.install(h,{title:"This page could not be found.",link:{text:"Visit login",location:"/login"}})})).on("not-allowed",(()=>{N.install(h,{title:"You are not allowed to view this page.",link:{text:"Visit login",location:"/login"}})})).navigateToCurrent()}();